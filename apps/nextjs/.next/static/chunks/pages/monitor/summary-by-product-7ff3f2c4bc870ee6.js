(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[858],{8718:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/monitor/summary-by-product",function(){return a(5494)}])},8646:function(e,t,a){"use strict";var l=a(2322),r=a(2784),s=a(4468),d=a(3738),n=a(261),c=a(3411);s.kL.register(s.uw,s.f$,s.ZL,s.u);let createLinearGradient=(e,t,a)=>{if(!e.chart.chartArea||!e.chart.scales.y)return;let l=e.chart.ctx,r=e.dataIndex,{value:s}=e.dataset.data[r],d=e.chart.chartArea.height,n=e.chart.chartArea.top,c=e.chart.scales.y.max,i=e.chart.scales.y.min,o=-i*d/(c-i),u=s*d/(c-i),m=l.createLinearGradient(0,d-o-u+n,0,d-o+n);return m.addColorStop(0,t),m.addColorStop(1,a),m};t.Z=e=>{var t;let{chartData:a,selectedProductIds:i,mode:o,barWidth:u,labelsSize:m,maxYValue:x,unit:p}=e;s.kL.defaults.datasets.bar.barThickness=null!=u?u:45;let[h,f]=(0,r.useState)();return(0,l.jsx)(d.$Q,{data:{datasets:a.datasets,labels:null===(t=a.datasets[0])||void 0===t?void 0:t.data.map(e=>e.label)},options:{animation:{duration:h,onComplete:()=>!h&&f(0)},parsing:{yAxisKey:"value",xAxisKey:"label"},responsive:!0,maintainAspectRatio:!1,elements:{bar:{backgroundColor:e=>{if(0!==e.datasetIndex)return"#DFE3E8";{if((null==i?void 0:i.length)===0||!i)return createLinearGradient(e,"#EB5444","#EA40A6");let t=e.dataset.data[e.dataIndex];return t.id&&(0,n.VL)(t.id,i)?createLinearGradient(e,"#EB5444","#EA40A6"):"#DFE3E8"}},borderWidth:e=>{if(0!==e.datasetIndex)return 1},borderColor:e=>{if(0!==e.datasetIndex)return"#919EAB"},borderRadius:8}},scales:{x:{stacked:!0,grid:{display:!1},border:{display:!1},ticks:{padding:10,color:"#919EAB",maxRotation:0,autoSkip:!1,font:{size:m,family:"Poppins"}}},y:{max:x,ticks:{font:{size:m,family:"Poppins"},stepSize:"absolute"===o?15:void 0,precision:10,padding:10,callback:e=>"".concat(e).concat(null!=p?p:""),color:"#919EAB"},grid:{drawTicks:!1,color:"#919EAB33"},border:{display:!1,dash:[3]}}},plugins:{datalabels:{display:!1},legend:{display:!1},tooltip:{enabled:!0,mode:"nearest",displayColors:!1,yAlign:"bottom",callbacks:{title:()=>"",label(e){let t=e.chart.data.datasets,a=e.datasetIndex,l=e.dataIndex;if(t.length>1&&1===a){var r,s;let e=null===(r=t[0])||void 0===r?void 0:r.data[l],a=null===(s=t[1])||void 0===s?void 0:s.data[l];return e.value===a.value?"":(0,c.N)(a.value)}let d=e.raw;return(0,c.N)(d.value)}}}}}})}},5494:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSP:function(){return B},default:function(){return S}});var l=a(2322),r=a(2784),s=a(6310),d=a(7989),n=a(2174),c=a(8109),i=a(857),o=a(261),u=a(6391),m=a(1267),x=a(2428),p=a(8590),h=a(6068),f=a(647),g=a(5819),y=a(3411),v=a(6229);let Tooltip=e=>{let{label:t,index:a,percentage:r}=e,s=Math.min(5*t.length,100),d=r<20?0===a?{left:-10}:{right:-10}:{left:-s/2+10};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(g.yQg,{size:16,className:(0,v.cn)("absolute bottom-5 text-gray/800",0===a?"text-gray-700":"text-gray-300")}),(0,l.jsx)("div",{className:"absolute bottom-[30px]",style:{...d},children:(0,l.jsx)("p",{className:(0,v.cn)("rounded-sm p-1 text-center text-[11px]",0===a?"bg-gray-700 text-white":"order-2 bg-gray-300"),style:{width:s},children:t})})]})};var molecules_BarChartHydronicCard=e=>{let{items:t}=e,a=(0,n.useTranslations)(),calculatePercentage=e=>e/t.reduce((e,t)=>e+t.value,0)*100;return(0,l.jsxs)("div",{className:"flex w-full flex-col",children:[(0,l.jsx)("p",{className:"mb-14 text-[15px] font-bold ",children:a("cards.barChartHydronicCard.title")}),(0,l.jsx)("div",{className:"flex h-7 w-full items-center rounded-full border-[1px] p-[1px] font-secondary text-xs",children:(0,l.jsx)("div",{className:"flex h-full w-full items-center rounded-full bg-gray-300",children:t.map((e,t)=>{let{name:a,value:r}=e;return r>0&&(0,l.jsx)("div",{className:(0,v.cn)("flex h-6 items-center justify-center gap-6 rounded-full font-secondary",0===t?"bg-gray-700 text-white":"order-2 bg-gray-300"),style:{width:"".concat(Math.max(calculatePercentage(r),15),"%")},children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(Tooltip,{label:"".concat(a,": ").concat((0,y.N)(r)," m\xb3/ton"),index:t,percentage:calculatePercentage(r)}),(0,l.jsxs)("p",{className:(0,v.cn)(0===t?"bg-gray-700 text-white":"order-2 bg-gray-300"),children:[(0,y.N)(calculatePercentage(r),1,!0),"%"]})]})},t)})})})]})},b=a(6405),molecules_KPISelectBar=e=>{let{kpis:t,selectedKpi:a,setSelectedKpi:r}=e,s=(0,n.useLocale)(),d=t.indexOf(a),c=d===t.length-1;return(0,l.jsxs)("div",{className:"mb-2 flex items-center justify-between rounded-sm bg-gray/200 px-6 py-2 font-bold",children:[(0,l.jsx)(g.u1R,{className:(0,v.cn)("hover:cursor-pointer",0===d&&"text-gray/400 hover:cursor-default"),onClick:()=>{let e=t[d-1];e&&r(e)}}),(0,l.jsx)("p",{className:"text-[15px]",children:(0,i.i)(null==a?void 0:a.name,s)}),(0,l.jsx)(g.hjJ,{className:(0,v.cn)("hover:cursor-pointer",c&&"text-gray/400 hover:cursor-default"),onClick:()=>{let e=t[d+1];e&&r(e)}})]})},j=a(486),N=a(6577),w=a.n(N),molecules_ProductCard=e=>{let{id:t,name:a,amount:r,imageUrl:s,disabled:d,selected:c,onClick:i}=e,o=(0,n.useTranslations)();return(0,l.jsxs)(u.Zb,{onClick:()=>!d&&i(t),className:(0,v.cn)("w-[175px] border p-4 hover:cursor-pointer",c?"border-secondary":"border-transparent",d&&"hover:cursor-not-allowed"),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[c?(0,l.jsx)(m.Z,{className:"truncate font-semibold",children:a}):(0,l.jsx)("p",{className:"truncate font-semibold text-gray/600",children:a}),(0,l.jsx)("div",{className:(0,v.cn)("flex h-6 w-6 items-center justify-center overflow-hidden rounded-full p-[5px]",c?"bg-secondary/lighter":"bg-gray/300"),children:(0,l.jsx)(w(),{src:null!=s?s:"/images/fallback-product-image.svg",alt:a,width:0,height:0,sizes:"100%",className:"w-full"})})]}),(0,l.jsx)("p",{className:(0,v.cn)("mt-2 font-bold",!c&&"text-gray/500",!r&&"mt-3.5 text-sm font-normal text-gray/600"),children:r?"".concat((0,y.N)(r)," ton"):o("monitor.summaryByProduct.ongoingCampaign")})]})},P=a(3230),_=a(8646),C=a(7687),hooks_useSummaryByProduct=e=>{var t,a;let{mode:l,category:s,selectedProductIds:d,setSelectedProductIds:c}=e,u=(0,n.useLocale)(),m=(0,n.useTranslations)(),{data:x,isLoading:p}=C.h.monitor.summaryByProduct.useQuery({category:s}),[h,f]=(0,r.useState)(),g=null!==(t=null==x?void 0:x.kpiBenchmarks)&&void 0!==t?t:[],y=null!==(a=null==x?void 0:x.productKpis)&&void 0!==a?a:[],v=y.map(e=>e.productCampaign.product),b=[];for(let e of v){let t=e.id;b.find(e=>e.id===t)||b.push(e)}b.sort((e,t)=>e.id.localeCompare(t.id));let j=y.map(e=>e.productCampaign),N=[];for(let e of j){let t=e.id;N.find(e=>e.id===t)||N.push(e)}let w=y.filter(e=>null==d?void 0:d.find(t=>e.productCampaign.product.id===t)),productHarvestedAmount=e=>{let t=N.find(t=>t.productId===e&&t.harvestedAmount);return t?N.filter(t=>t.productId===e).reduce((e,t)=>{var a;return e+(null!==(a=t.harvestedAmount)&&void 0!==a?a:0)},0):null},productKpiValue=e=>y.reduce((t,a)=>a.kpiId===(null==h?void 0:h.id)&&a.productCampaign.product.id===e?t+a.totalValue:t,0),P=[];for(let e of b)productHarvestedAmount(e.id)&&P.push(e.id);(0,r.useEffect)(()=>{var e,t;(null==x?void 0:null===(e=x.kpiBenchmarks)||void 0===e?void 0:e[0])&&!h&&f(null==x?void 0:null===(t=x.kpiBenchmarks)||void 0===t?void 0:t[0]),(null==x?void 0:x.productKpis)&&0===d.length&&c(P)},[x]);let _=y.map(e=>e.kpiId===(null==h?void 0:h.id)?e.totalValue:0).reduce((e,t)=>e+t,0),k=N.filter(e=>d.find(t=>t===e.productId)).reduce((e,t)=>{var a;return e+(null!==(a=t.harvestedAmount)&&void 0!==a?a:0)},0),selectedProductsKpi=e=>{var t;return null!==(t=w.map(t=>t.kpiId===e?t.totalValue:0).reduce((e,t)=>e+t,0))&&void 0!==t?t:0},barChartValues=e=>{let t=productHarvestedAmount(e.id);return"absolute"===l?0===_?0:productKpiValue(e.id)/_*100:t?productKpiValue(e.id)/t:0},B=y&&{datasets:[{data:"intensity"===l?b.filter(e=>!!productHarvestedAmount(e.id)).map(e=>({id:e.id,label:(0,i.i)(e.name,u),value:barChartValues(e)})):b.map(e=>({id:e.id,label:(0,i.i)(e.name,u),value:barChartValues(e)}))}]},findKpiKey=e=>{var t;return null===(t=g.find(t=>t.id===e))||void 0===t?void 0:t.key},getSelectedProductsBenchmarkSum=e=>{var t,a;let l=null!==(a=null===(t=g.find(t=>t.id===e))||void 0===t?void 0:t.organizationCampaignKpiBenchmarks.flatMap(e=>e.productKpiBenchmarks))&&void 0!==a?a:[],r=l.reduce((e,t)=>(d.includes(t.productId)&&(e+=t.benchmark),e),0);return r},S=!!w.find(e=>!e.productCampaign.endDate);return{kpiBenchmarks:g,products:b,selectedKpi:h,setSelectedKpi:f,productHarvestedAmount,barChartData:B,monitorCardAmount:e=>{let t=findKpiKey(e);return"absolute"===l||t&&(0,o.JU)(t)?selectedProductsKpi(e):k?selectedProductsKpi(e)/k:0},monitorCardVariation:e=>{let t=findKpiKey(e),a=getSelectedProductsBenchmarkSum(e);if(t&&(0,o.JU)(t))return(selectedProductsKpi(e)-a)/a*100;let l=k?selectedProductsKpi(e)/k:0;return(l-a)/a*100},selectedProductsScopes:()=>{let e=["scope1","scope2","scope3"].map((e,t)=>({name:"S".concat(t+1),value:0===_?0:(null==w?void 0:w.reduce((t,a)=>{var l,r;return t+(null!==(r=null===(l=a.scopes)||void 0===l?void 0:l[e])&&void 0!==r?r:0)},0))/_}));return e},selectedProductsWaterFootprints:()=>{let e=["blueFootprint","greenFootprint"].map(e=>({name:m("waterFootprints.".concat(e)),value:null==w?void 0:w.reduce((t,a)=>{var l,r;return t+(null!==(r=null===(l=a.waterComposition)||void 0===l?void 0:l[e])&&void 0!==r?r:0)},0)}));return e},onProductCardClick:e=>{let t=d.find(t=>e===t);if(d.length===P.length)return c([e]);if(t&&1===d.length)return c(P);if(t){let t=d.indexOf(e),a=[...d.slice(0,t),...d.slice(t+1)];c(a);return}let a=[...d,e];c(a)},showOngoingCampaign:S,noFinishedCampaigns:()=>{let e=N.filter(e=>d.includes(e.productId)),t=e.find(e=>!!e.endDate);return!t},isProductSelected:e=>!!d.find(t=>e===t),pageDataLoading:p}};let Shimmer=()=>(0,l.jsxs)("div",{className:"flex h-full min-h-[calc(100vh_-_260px)] flex-col gap-4 lg:flex-row",children:[(0,l.jsxs)("div",{className:"flex h-full w-full flex-col gap-y-4 lg:w-2/3",children:[(0,l.jsx)(u.Zb,{className:"h-[126px] pr-2 2xl:h-fit 2xl:max-h-[234px]",children:(0,l.jsxs)("div",{className:"flex h-full flex-wrap gap-x-4 gap-y-4 overflow-hidden px-4 py-4",children:[(0,l.jsx)(h.O,{className:"h-[94px] w-[200px]"}),(0,l.jsx)(h.O,{className:"h-[94px] w-[200px]"}),(0,l.jsx)(h.O,{className:"h-[94px] w-[200px]"})]})}),(0,l.jsxs)(u.Zb,{className:"flex h-full flex-col gap-2 p-4 lg:h-[calc(100vh_-_348px)] lg:max-h-[650px] lg:min-h-[380px]",children:[(0,l.jsx)(h.O,{className:"h-[25px] w-[300px]"}),(0,l.jsx)(h.O,{className:"h-[25px] w-[200px]"}),(0,l.jsx)(h.O,{className:"mt-2 h-10 w-full"}),(0,l.jsx)(h.O,{className:"h-[calc(100%_-_105px)] max-h-[400px] min-h-[200px] lg:max-h-[500px]"})]})]}),(0,l.jsx)("div",{className:"flex min-h-[518px] flex-col gap-y-4 lg:w-1/3",children:(0,l.jsxs)(u.Zb,{className:"h-fit max-h-full min-h-[300px] overflow-visible px-2 py-4 lg:h-[calc(100vh_-_210px)]",children:[(0,l.jsx)(h.O,{className:"mb-4 h-[30px] w-[200px]"}),(0,l.jsxs)("div",{className:"flex h-full flex-col gap-4 pb-4",children:[(0,l.jsx)(h.O,{className:"h-[140px] w-full"}),(0,l.jsx)(h.O,{className:"h-[140px] w-full"}),(0,l.jsx)(h.O,{className:"h-[140px] w-full"})]})]})})]});var monitor_SummaryByProduct=e=>{let{mode:t,category:a,showScopes:s,showWaterFootprints:d,selectedProductIds:h,setSelectedProductIds:g}=e,y=(0,n.useTranslations)(),v=(0,n.useLocale)(),{kpiBenchmarks:N,products:w,selectedKpi:C,setSelectedKpi:k,productHarvestedAmount:B,barChartData:S,monitorCardAmount:I,monitorCardVariation:K,selectedProductsScopes:A,selectedProductsWaterFootprints:E,onProductCardClick:Z,showOngoingCampaign:T,noFinishedCampaigns:F,isProductSelected:L,pageDataLoading:O}=hooks_useSummaryByProduct({mode:t,category:a,selectedProductIds:h,setSelectedProductIds:g});return O||!C?(0,l.jsx)(Shimmer,{}):F()?(0,l.jsx)("div",{className:"h-[calc(100vh_-_260px)] lg:h-[calc(100vh_-_210px)]",children:(0,l.jsx)(P.Z,{})}):(0,l.jsxs)("div",{className:"flex h-full flex-1 flex-col gap-4 lg:flex-row",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-4 lg:w-2/3",children:[(0,l.jsx)(u.Zb,{className:"w-full",children:(0,l.jsxs)(x.x,{children:[(0,l.jsx)("div",{className:"flex h-full w-full gap-x-4 gap-y-4 px-4 py-4",children:null==w?void 0:w.map(e=>(0,l.jsx)(molecules_ProductCard,{id:e.id,name:(0,i.i)(e.name,v),amount:B(e.id),imageUrl:(0,c._z)(e.imageS3Key),selected:L(e.id),onClick:()=>Z(e.id),disabled:!B(e.id)},e.id))}),(0,l.jsx)(x.B,{orientation:"horizontal"})]})}),(0,l.jsxs)(u.Zb,{className:"h-full p-4 lg:h-[calc(100vh_-_348px)] lg:max-h-[650px] lg:min-h-[380px]",children:[(0,l.jsx)(m.Z,{children:y("monitor.summaryByProduct.productPerformance")}),(0,l.jsx)("p",{className:"mb-4 text-xs text-gray/600",children:"absolute"===t?y("monitor.summaryByProduct.productContribution"):y("monitor.summaryByProduct.productImpact",{unit:"".concat(C.unit).concat((0,o.JU)(C.key)?"":" / ton")})}),(0,l.jsx)(molecules_KPISelectBar,{kpis:N,selectedKpi:C,setSelectedKpi:k}),0===h.length?(0,l.jsx)("div",{className:"flex h-[calc(100vh_-_480px)] max-h-[400px] min-h-[200px] items-center justify-center rounded-lg border border-gray/200 bg-gray/100 lg:max-h-[500px]",children:(0,l.jsx)("p",{className:"text-sm text-gray/500",children:y("monitor.summaryByProduct.pleaseSelect")})}):(0,l.jsx)("div",{className:"h-[calc(100%_-_105px)] max-h-[400px] min-h-[200px] lg:max-h-[500px]",children:(0,l.jsx)(_.Z,{chartData:S,selectedProductIds:h,mode:t,unit:"absolute"===t?"%":""})})]})]}),(0,l.jsxs)("div",{className:"flex min-h-[518px] flex-col gap-y-4 lg:max-h-[calc(100vh_-_210px)] lg:w-1/3",children:[(0,l.jsxs)(u.Zb,{className:"h-fit max-h-full min-h-[300px] overflow-visible px-2 py-4",children:[(0,l.jsx)("p",{className:"mb-4 px-4 font-bold text-gray/600",children:y("monitor.summaryByProduct.kpiResults")}),(0,l.jsxs)(x.x,{className:"h-[calc(100%_-_40px)]",children:[N.map((e,a)=>(0,l.jsxs)(r.Fragment,{children:[(0,l.jsx)("div",{className:"hover:cursor-pointer",onClick:()=>k(e),children:(0,l.jsx)(j.Z,{title:(0,i.i)(e.name,v),amount:I(e.id),unit:"absolute"===t||(0,o.JU)(e.key)?e.unit:"".concat(e.unit," / ton"),variation:K(e.id),isCard:!1,selected:(null==C?void 0:C.id)===e.id,enableFooter:e.organizationCampaignKpiBenchmarks.length>0})}),N.length-1!==a&&(0,l.jsx)(p.Z,{className:"mx-2 my-4 border-dashed border-gray/400"})]},e.id)),s&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p.Z,{className:"mx-2 my-4 border-dashed border-gray/400"}),(0,l.jsx)("div",{className:"px-4",children:0===h.length?(0,l.jsxs)("div",{className:"flex w-full flex-col gap-4",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)("p",{className:"text-lg font-bold",children:y("cards.barChartGHGCard.title")}),(0,l.jsx)("p",{className:"text-xs",children:y("cards.barChartGHGCard.subtitle")})]}),(0,l.jsx)("div",{className:"flex h-[68px] items-center justify-center rounded-lg bg-gray/100",children:(0,l.jsx)("p",{className:"text-center text-xs text-gray/500",children:y("monitor.summaryByProduct.pleaseSelect")})})]}):(0,l.jsx)(f.Z,{items:A(),showInformation:!0})})]}),d&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p.Z,{className:"mx-2 my-4 border-dashed border-gray/400"}),0===h.length?(0,l.jsxs)("div",{className:"flex w-full flex-col gap-4 p-6",children:[(0,l.jsx)("p",{className:"mb-2 font-bold ",children:y("cards.barChartHydronicCard.title")}),(0,l.jsx)("div",{className:"flex h-[52px] items-center justify-center rounded-lg bg-gray/100",children:(0,l.jsx)("p",{className:"text-center text-xs text-gray/500",children:y("monitor.summaryByProduct.pleaseSelect")})})]}):(0,l.jsx)("div",{className:"p-6",children:(0,l.jsx)(molecules_BarChartHydronicCard,{items:E()})})]})]})]}),T&&(0,l.jsx)(b.Z,{text:y("monitor.summaryByProduct.ongoingCampaignMessage")})]})]})},k=a(3197);let SummaryByProductPage=()=>{let[e,t]=(0,r.useState)("climateChange"),[a,n]=(0,r.useState)("absolute"),[c,i]=(0,r.useState)([]);return(0,l.jsx)(d.Z,{switchTabs:(0,l.jsx)(s.Z,{key1:"intensity",key2:"absolute",setSelected:n,defaultValue:"absolute"}),selectedTab:e,setSelectedTab:t,tabs:[{key:"climateChange",content:(0,l.jsx)(monitor_SummaryByProduct,{mode:a,category:"ClimateChange",showScopes:!0,selectedProductIds:c,setSelectedProductIds:i})},{key:"ecosystemQuality",content:(0,l.jsx)(monitor_SummaryByProduct,{mode:a,category:"EcosystemQuality",selectedProductIds:c,setSelectedProductIds:i})},{key:"humanHealth",content:(0,l.jsx)(monitor_SummaryByProduct,{mode:a,category:"HumanHealth",selectedProductIds:c,setSelectedProductIds:i})},{key:"resourcesExhaustion",content:(0,l.jsx)(monitor_SummaryByProduct,{mode:a,category:"ResourcesExhaustion",showWaterFootprints:!0,selectedProductIds:c,setSelectedProductIds:i})}]})};SummaryByProductPage.getLayout=e=>(0,l.jsx)(k.Z,{titleKey:"summaryByProduct",children:e});var B=!0,S=SummaryByProductPage},8109:function(e,t,a){"use strict";a.d(t,{_z:function(){return imageUrlFromKey},sT:function(){return fileToBase64},u:function(){return imageUrlToFile}});var l=a(5803);let fileToBase64=e=>new Promise((t,a)=>{let l=new FileReader;l.readAsDataURL(e),l.onload=()=>t(l.result),l.onerror=e=>a(e)}),imageUrlToFile=async e=>{let t=await fetch(e,{cache:"no-cache"}),a=await t.blob(),l=new File([a],e);return l},imageUrlFromKey=e=>e?"".concat(l.O.NEXT_PUBLIC_IMAGE_BUCKET_BASE_URL,"/").concat(e):null}},function(e){e.O(0,[235,917,525,461,898,713,872,767,612,512,535,372,965,641,624,774,888,179],function(){return e(e.s=8718)}),_N_E=e.O()}]);