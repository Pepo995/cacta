(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[949],{9354:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/analyze/performance",function(){return t(9108)}])},6391:function(e,a,t){"use strict";t.d(a,{Zb:function(){return r}});var l=t(2322),s=t(2784),i=t(6229);let r=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)("div",{ref:a,className:(0,i.cn)("rounded-xxl bg-card text-card-foreground shadow-default",t),...s})});r.displayName="Card";let n=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)("div",{ref:a,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...s})});n.displayName="CardHeader";let d=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)("h3",{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight text-neutral-400",t),...s})});d.displayName="CardTitle";let c=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)("p",{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...s})});c.displayName="CardDescription";let o=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)("div",{ref:a,className:(0,i.cn)("h-full p-6 pt-0",t),...s})});o.displayName="CardContent";let u=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)("div",{ref:a,className:(0,i.cn)(" flex items-center p-6 pt-0",t),...s})});u.displayName="CardFooter"},4927:function(e,a,t){"use strict";t.d(a,{SP:function(){return u},dr:function(){return o},mQ:function(){return c},nU:function(){return m}});var l=t(2322),s=t(2784),i=t(4372),r=t(929),n=t(6229);let d=(0,r.j)("focus-visible:ring-ring whitespace-nowrap px-3 font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"rounded-md py-2 text-sm text-gray/600 data-[state=active]:bg-gradient-secondary data-[state=active]:text-white data-[state=active]:shadow",secondary:"py-1.5 text-base"}},defaultVariants:{variant:"default"}}),c=i.fC,o=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)(i.aV,{ref:a,className:(0,n.cn)("inline-flex h-11 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",t),...s})});o.displayName=i.aV.displayName;let u=s.forwardRef((e,a)=>{let{className:t,variant:s,...r}=e;return(0,l.jsx)(i.xz,{ref:a,className:(0,n.cn)(d({variant:s}),t),...r})});u.displayName=i.xz.displayName;let m=s.forwardRef((e,a)=>{let{className:t,...s}=e;return(0,l.jsx)(i.VY,{ref:a,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none",t),...s})});m.displayName=i.VY.displayName},4830:function(e,a,t){"use strict";t.d(a,{_v:function(){return o},aJ:function(){return c},pn:function(){return n},u:function(){return d}});var l=t(2322),s=t(2784),i=t(535),r=t(6229);let n=i.zt,d=i.fC,c=i.xz,o=s.forwardRef((e,a)=>{let{className:t,sideOffset:s=4,...n}=e;return(0,l.jsx)(i.VY,{ref:a,sideOffset:s,className:(0,r.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})});o.displayName=i.VY.displayName},486:function(e,a,t){"use strict";var l=t(2322),s=t(2174),i=t(9611),r=t(3411),n=t(6229),d=t(6391),c=t(1267);a.Z=e=>{let{title:a,amount:t,unit:o,variation:u,isCard:m=!0,selected:x,enableFooter:p=!0,className:h}=e,f=(0,s.useTranslations)();return(0,l.jsx)(d.Zb,{className:(0,n.cn)("p-4",h,x&&"bg-gray/100",!m&&"shadow-none"),children:(0,l.jsxs)("div",{className:"flex min-w-[220px] flex-col justify-between gap-1",children:[(0,l.jsx)("p",{className:"truncate text-[15px] font-bold",children:a}),(0,l.jsx)("div",{className:"flex w-fit items-center",children:(0,l.jsxs)(c.Z,{variant:p&&u?u>0?"error":"success":"secondary",className:"truncate text-[15px]",children:[(0,r.N)(t)," ",o]})}),p&&u&&(0,l.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,l.jsx)("div",{className:"h-5 w-5",children:u>0?(0,l.jsx)(i.V4j,{size:20,className:"rounded-full bg-error/lighter p-1 text-error"}):(0,l.jsx)(i.GGD,{size:20,className:"rounded-full bg-success/lighter p-1 text-success"})}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsxs)(c.Z,{className:"text-xs font-semibold",variant:u>0?"error":"success",children:[u>0&&"+",(0,r.N)(u,1,!0),"%"]}),(0,l.jsx)("p",{className:"text-[11px] font-medium text-gray/600",children:f("cards.monitorCard.vsTarget")})]})]})]})})}},6310:function(e,a,t){"use strict";var l=t(2322),s=t(2174),i=t(4927);a.Z=e=>{let{key1:a,key2:t,setSelected:r,defaultValue:n}=e,d=(0,s.useTranslations)();return(0,l.jsx)(i.mQ,{defaultValue:null!=n?n:a,children:(0,l.jsx)(i.dr,{className:"bg-white",children:[a,t].map(e=>(0,l.jsx)(i.SP,{className:"text-xs",value:e,onClick:()=>r(e),children:d("switchTabs.".concat(e))},e))})})}},3230:function(e,a,t){"use strict";var l=t(2322),s=t(2174),i=t(951),r=t(6391);a.Z=()=>{let e=(0,s.useTranslations)();return(0,l.jsxs)(r.Zb,{className:"flex h-full flex-col items-center justify-center border border-info_16 bg-info_8 p-4 shadow-none",children:[(0,l.jsx)(i.kA6,{className:"mb-2 text-info",size:24}),(0,l.jsx)("p",{className:"whitespace-pre-line text-center text-sm font-semibold text-info/dark",children:e("uncompletedCampaign.title")})]})}},8646:function(e,a,t){"use strict";var l=t(2322),s=t(2784),i=t(4468),r=t(3738),n=t(261),d=t(3411);i.kL.register(i.uw,i.f$,i.ZL,i.u);let createLinearGradient=(e,a,t)=>{if(!e.chart.chartArea||!e.chart.scales.y)return;let l=e.chart.ctx,s=e.dataIndex,{value:i}=e.dataset.data[s],r=e.chart.chartArea.height,n=e.chart.chartArea.top,d=e.chart.scales.y.max,c=e.chart.scales.y.min,o=-c*r/(d-c),u=i*r/(d-c),m=l.createLinearGradient(0,r-o-u+n,0,r-o+n);return m.addColorStop(0,a),m.addColorStop(1,t),m};a.Z=e=>{var a;let{chartData:t,selectedProductIds:c,mode:o,barWidth:u,labelsSize:m,maxYValue:x,unit:p}=e;i.kL.defaults.datasets.bar.barThickness=null!=u?u:45;let[h,f]=(0,s.useState)();return(0,l.jsx)(r.$Q,{data:{datasets:t.datasets,labels:null===(a=t.datasets[0])||void 0===a?void 0:a.data.map(e=>e.label)},options:{animation:{duration:h,onComplete:()=>!h&&f(0)},parsing:{yAxisKey:"value",xAxisKey:"label"},responsive:!0,maintainAspectRatio:!1,elements:{bar:{backgroundColor:e=>{if(0!==e.datasetIndex)return"#DFE3E8";{if((null==c?void 0:c.length)===0||!c)return createLinearGradient(e,"#EB5444","#EA40A6");let a=e.dataset.data[e.dataIndex];return a.id&&(0,n.VL)(a.id,c)?createLinearGradient(e,"#EB5444","#EA40A6"):"#DFE3E8"}},borderWidth:e=>{if(0!==e.datasetIndex)return 1},borderColor:e=>{if(0!==e.datasetIndex)return"#919EAB"},borderRadius:8}},scales:{x:{stacked:!0,grid:{display:!1},border:{display:!1},ticks:{padding:10,color:"#919EAB",maxRotation:0,autoSkip:!1,font:{size:m,family:"Poppins"}}},y:{max:x,ticks:{font:{size:m,family:"Poppins"},stepSize:"absolute"===o?15:void 0,precision:10,padding:10,callback:e=>"".concat(e).concat(null!=p?p:""),color:"#919EAB"},grid:{drawTicks:!1,color:"#919EAB33"},border:{display:!1,dash:[3]}}},plugins:{datalabels:{display:!1},legend:{display:!1},tooltip:{enabled:!0,mode:"nearest",displayColors:!1,yAlign:"bottom",callbacks:{title:()=>"",label(e){let a=e.chart.data.datasets,t=e.datasetIndex,l=e.dataIndex;if(a.length>1&&1===t){var s,i;let e=null===(s=a[0])||void 0===s?void 0:s.data[l],t=null===(i=a[1])||void 0===i?void 0:i.data[l];return e.value===t.value?"":(0,d.N)(t.value)}let r=e.raw;return(0,d.N)(r.value)}}}}}})}},7989:function(e,a,t){"use strict";var l=t(2322);t(2784);var s=t(2174),i=t(6229),r=t(2428),n=t(4927);a.Z=e=>{let{tabs:a,selectedTab:t,setSelectedTab:d,switchTabs:c,className:o}=e,u=(0,s.useTranslations)();return(0,l.jsx)("div",{className:o,children:(0,l.jsxs)(n.mQ,{defaultValue:t,children:[(0,l.jsxs)("div",{className:"mb-4 flex flex-col justify-between lg:mb-0 lg:flex-row",children:[(0,l.jsx)(r.x,{children:(0,l.jsxs)(n.dr,{className:"mb-4 w-full justify-start gap-x-6 whitespace-nowrap rounded-none border-b-[1px] border-gray/500 p-0 pl-1 pr-20 font-secondary text-gray/500",children:[a.map(e=>(0,l.jsx)(n.SP,{onClick:()=>d(e.key),variant:"secondary",value:e.key,className:(0,i.cn)("translate-y-1.5 px-0 text-sm",t===e.key&&"border-b-[1px] border-secondary text-secondary"),children:u("navigationTab.".concat(e.key))},"tab-".concat(e.key))),(0,l.jsx)(r.B,{orientation:"horizontal"})]})}),c]}),a.map(e=>(0,l.jsx)(n.nU,{value:e.key,children:e.content},"tab-".concat(e.key)))]})})}},9108:function(e,a,t){"use strict";t.r(a),t.d(a,{__N_SSP:function(){return A},default:function(){return V}});var l=t(2322),s=t(2784),i=t(6310),r=t(7989),n=t(2174),d=t(3988),c=t(261),o=t(6391),u=t(1267),m=t(8590),x=t(6068),p=t(535),h=t(3411),f=t(6229),v=t(2428),g=t(4830);let LegendItem=e=>{let{label:a,color:t}=e;return(0,l.jsxs)("div",{className:"flex gap-1.5",children:[(0,l.jsx)("div",{className:"mt-1.5 h-1 w-5 rounded-full",style:{backgroundColor:t}}),(0,l.jsx)("p",{className:"text-[10px] text-gray/600",children:a})]})},StagesBars=e=>{let{label:a,value:t,color:s,isLast:i}=e;return(0,l.jsx)(g.pn,{children:(0,l.jsxs)(g.u,{children:[(0,l.jsx)(g.aJ,{asChild:!0,children:(0,l.jsx)("div",{className:(0,f.cn)("h-full cursor-pointer",i&&"rounded-r-full"),style:{width:"".concat(Math.abs(t),"%"),backgroundColor:s}})}),(0,l.jsxs)(g._v,{className:"border-none bg-gray/900 text-xs text-white",children:[(0,l.jsx)(p.Eh,{}),(0,l.jsxs)("p",{children:[a,": ",(0,h.N)(t,1,!0),"%"]})]})]})})};var molecules_ListCard=e=>{let{title:a,data:t,showStages:s}=e,i=(0,n.useTranslations)();return(0,l.jsxs)(o.Zb,{className:"h-full p-4",children:[(0,l.jsx)(u.Z,{children:a}),(0,l.jsx)(m.Z,{className:"mb-5 mt-3 border-dashed border-gray-300"}),s?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(v.x,{className:"h-[240px] lg:h-[calc(100%_-_120px)]",children:(0,l.jsx)("div",{className:"flex flex-col gap-y-4",children:t.map((e,a)=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-2 flex justify-between text-sm",children:[(0,l.jsxs)("p",{className:"font-semibold",children:[a+1," | ",e.name]}),(0,l.jsxs)("p",{className:"text-gray/400",children:[(0,h.N)(e.totalValue,1,!0),"%"]})]}),(0,l.jsxs)("div",{className:"relative flex h-1 w-full overflow-hidden rounded-full bg-gray/100",children:[(0,l.jsx)(StagesBars,{label:i("performancePerKpi.viewStages.step1Title"),value:e.upstream,color:"#c684ff"}),(0,l.jsx)(StagesBars,{label:i("performancePerKpi.viewStages.step2Title"),value:e.transportation,color:"#8e33ff"}),(0,l.jsx)(StagesBars,{label:i("performancePerKpi.viewStages.step3Title"),value:e.core,color:"#5119b7",isLast:!0})]})]},a))})}),(0,l.jsxs)(v.x,{children:[(0,l.jsxs)("div",{className:"mt-4 flex h-12 items-center justify-between gap-3 rounded-md border border-dashed border-gray/300 px-2",children:[(0,l.jsx)(LegendItem,{label:i("performancePerKpi.viewStages.step1Title"),color:"#c684ff"}),(0,l.jsx)(LegendItem,{label:i("performancePerKpi.viewStages.step2Title"),color:"#8e33ff"}),(0,l.jsx)(LegendItem,{label:i("performancePerKpi.viewStages.step3Title"),color:"#5119b7"})]}),(0,l.jsx)(v.B,{orientation:"horizontal"})]})]}):(0,l.jsx)(v.x,{className:"h-[calc(100%_-_55px)]",children:(0,l.jsx)("div",{className:"flex flex-col gap-y-4",children:t.map((e,a)=>(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"mb-2 flex justify-between text-sm",children:[(0,l.jsxs)("p",{className:"font-semibold",children:[a+1," | ",e.name]}),(0,l.jsxs)("p",{className:"text-gray/400",children:[(0,h.N)(e.value,1,!0),"%"]})]}),(0,l.jsx)("div",{className:"h-[3px] w-full rounded-full bg-secondary/lighter",children:(0,l.jsx)("div",{className:"h-full rounded-full bg-secondary",style:{width:"".concat(e.value,"%")}})})]},a))})})]})},j=t(486),y=t(6577),b=t.n(y),molecules_SustainableGoals=e=>{let{category:a}=e,t=(0,n.useTranslations)();return(0,l.jsxs)(o.Zb,{className:"flex w-auto gap-2 bg-gray/100 p-2 shadow-none",children:[(0,l.jsx)("div",{className:"w-10",children:(0,l.jsx)(b(),{alt:a,src:{ClimateChange:"/images/sustainable-goals/climate-change.png",EcosystemQuality:"/images/sustainable-goals/ecosystem-quality.png",HumanHealth:"/images/sustainable-goals/human-health.png",ResourcesExhaustion:"/images/sustainable-goals/resources-exhaustion.png"}[a],height:50,width:50,className:"rounded-[2px]"})}),(0,l.jsxs)("div",{className:"w-fit",children:[(0,l.jsx)("h3",{className:(0,f.cn)("mb-[1px] text-[11px] font-semibold leading-3 2xl:text-xs",{ClimateChange:"text-[#118D57]",EcosystemQuality:"text-[#006C9C]",HumanHealth:"text-[#00A76F]",ResourcesExhaustion:"text-[#B76E00]"}[a]),children:t("sustainableGoals.title.".concat(a))}),(0,l.jsxs)("p",{className:"text-[10px] leading-[14px] text-gray/600 2xl:text-xs",children:[t("sustainableGoals.description.".concat(a)),(0,l.jsx)("a",{href:{ClimateChange:"https://www.un.org/sustainabledevelopment/es/climate-change-2/",EcosystemQuality:"https://www.un.org/sustainabledevelopment/es/oceans/",HumanHealth:"https://www.un.org/sustainabledevelopment/es/health/",ResourcesExhaustion:"https://www.un.org/sustainabledevelopment/es/sustainable-consumption-production/"}[a],target:"_blank",className:"ml-1 underline",children:t("text.seeMore")})]})]})]})},w=t(3230),N=t(8646),P=t(4468),S=t(6881),k=t(3738);P.kL.register(P.l7,P.qi,S.Z);let createLinearGradient=(e,a,t)=>{if(!e.chart.chartArea)return;let l=e.chart.ctx,s=e.chart.chartArea.top,i=e.chart.chartArea.bottom,r=e.chart.chartArea.left,n=e.chart.chartArea.right,d=l.createLinearGradient(s,r,i,n);return d.addColorStop(0,a),d.addColorStop(1,t),d};var organisms_DoughnutChart=e=>{let{chartData:a,selectedActivities:t}=e;return(0,l.jsx)(k.$I,{data:a,options:{parsing:{key:"value"},maintainAspectRatio:!1,layout:{padding:{top:30,bottom:30,right:145,left:145}},cutout:"60%",events:[],elements:{arc:{backgroundColor:function(e){let a=e.dataset.data[e.dataIndex];return!(0,c.VL)(a.id,t)&&t.length>0?"#DFE3E8":0===e.dataIndex?createLinearGradient(e,"#FFAB00","#B76E00"):1===e.dataIndex?createLinearGradient(e,"#b76e0099","#ffab0099"):createLinearGradient(e,"#ffab003d","#b76e003d")},hoverBorderColor:"#ffffff",borderWidth:2}},plugins:{tooltip:{enabled:!1},legend:{display:!1},datalabels:{padding:{top:4,bottom:2},anchor:"end",align:"end",offset:10,font:{family:"Poppins"},display:e=>{var a,l;let s=e.dataIndex,i=e.dataset.data,r=null!==(l=null===(a=i[s])||void 0===a?void 0:a.id)&&void 0!==l?l:"";return!!(0,c.VL)(r,t)||"auto"},borderRadius:4,color:e=>{var a,l;let s=e.dataIndex,i=e.dataset.data,r=null!==(l=null===(a=i[s])||void 0===a?void 0:a.id)&&void 0!==l?l:"";return!(0,c.VL)(r,t)&&t.length>0?"#DFE3E8ba":0===e.dataIndex||1===e.dataIndex?"white":"black"},backgroundColor:e=>{var a,l;let s=e.chart.ctx,i=s.createLinearGradient(-10,-10,20,50),r=e.dataIndex,n=e.dataset.data,d=null!==(l=null===(a=n[r])||void 0===a?void 0:a.id)&&void 0!==l?l:"";return!(0,c.VL)(d,t)&&t.length>0?"#DFE3E850":(0===r?(i.addColorStop(0,"#FFAB00"),i.addColorStop(1,"#B76E00")):1===r?(i.addColorStop(0,"#ffab0099"),i.addColorStop(1,"#b76e0099")):(i.addColorStop(0,"#ffab003d"),i.addColorStop(1,"#b76e003d")),i)},formatter:function(e,a){var t,l,s;return"".concat(null==a?void 0:null===(s=a.chart)||void 0===s?void 0:null===(l=s.data)||void 0===l?void 0:null===(t=l.labels)||void 0===t?void 0:t[a.dataIndex],": ").concat((0,h.N)(parseFloat(e.value),1,!0),"%")}}}}})},C=t(6507),_=t(857),I=t(9276),K=t(7936),organisms_FiltersBar=e=>{let{products:a,selectedProduct:t,setSelectedProduct:i,kpis:r,selectedKpiIds:d,setSelectedKpiIds:c,activities:u,selectedActivities:x,setSelectedActivities:p,disableActivityFilter:h,multiselect:f}=e,g=(0,n.useTranslations)(),j=(0,n.useLocale)(),onKpiClick=e=>{if(!f){c(e);return}let a=d.find(a=>a===e);if(a){let a=d.indexOf(e),t=[...d.slice(0,a),...d.slice(a+1)];c(t);return}let t=[...d,e];c(t)},onActivityClick=e=>{let a=x.find(a=>a===e);if(a){let a=x.indexOf(e),t=[...x.slice(0,a),...x.slice(a+1)];p(t);return}let t=[...x,e];if(t.length===u.length)return p([]);p(t)};return(0,s.useEffect)(()=>{h&&p([])},[d]),(0,l.jsxs)(o.Zb,{className:"px-4 py-3",children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-gray/700",children:g("filters.title")}),(0,l.jsxs)("div",{className:"flex w-full items-center py-2",children:[(0,l.jsxs)(K.Ph,{onValueChange:e=>i(e),value:t,children:[(0,l.jsx)(K.i4,{className:"h-7 w-[360px] border-secondary/light font-secondary text-xs font-semibold text-secondary/light",children:(0,l.jsx)(K.ki,{placeholder:g("performancePerKpi.viewPanel.selectAProduct")})}),(0,l.jsx)(K.Bw,{children:a.map(e=>(0,l.jsx)(K.Ql,{value:e.id,children:(0,_.i)(e.name,j)},e.id))})]}),(0,l.jsx)("div",{className:"mx-4 h-9 border-r border-dashed border-gray/400"}),(0,l.jsxs)(C.xr,{className:"w-full overflow-auto whitespace-nowrap",children:[(0,l.jsx)("div",{className:"flex gap-x-4",children:r.map(e=>(0,l.jsx)(I.z,{className:"h-auto w-full px-1 py-[5px] text-xs",variant:!f&&d===e.id||f&&(null==d?void 0:d.some(a=>a===e.id))?"secondary-outline":"inactive-outline",onClick:()=>onKpiClick(e.id),children:(0,_.i)(e.name,j)},e.id))}),(0,l.jsx)(v.B,{orientation:"horizontal"})]})]}),(0,l.jsx)(m.Z,{className:"border-dashed border-gray-300"}),(0,l.jsxs)(C.xr,{className:"w-full overflow-auto whitespace-nowrap",children:[(0,l.jsxs)("div",{className:"flex w-full items-center gap-x-4 pt-3",children:[(0,l.jsx)(I.z,{className:"h-auto w-full px-1 py-[5px] text-xs",variant:0===x.length?"secondary-outline":"inactive-outline",onClick:()=>p([]),disabled:h,children:g("filters.activity.viewAll")},"ViewAll"),u.map(e=>(0,l.jsx)(I.z,{className:"h-auto w-full px-1 py-[5px] text-xs",variant:(null==x?void 0:x.some(a=>e===a))?"secondary-outline":"inactive-outline",onClick:()=>onActivityClick(e),disabled:h,children:g("filters.activity.".concat(e))},e))]}),(0,l.jsx)(v.B,{orientation:"horizontal"})]})]})},L=t(7687);let z=["Fertilizers","Agrochemicals","Machinery","Electricity","Soil","Other"];var hooks_usePerformancePanel=e=>{var a,t,l,i,r;let{category:d,selectedProductId:o,setSelectedProductId:u}=e,m=(0,n.useTranslations)(),x=(0,n.useLocale)(),[p,f]=(0,s.useState)(),[v,g]=(0,s.useState)([]),{data:j,isLoading:y}=L.h.analyze.productsAndKpisList.useQuery({category:d}),b=null!==(a=null==j?void 0:j.kpisList.filter(e=>"WaterProductivity"!==e.key))&&void 0!==a?a:[];(0,s.useEffect)(()=>{if(j){var e,a;o||u(null===(e=j.productsList[0])||void 0===e?void 0:e.id),p||f(null==b?void 0:null===(a=b[0])||void 0===a?void 0:a.id)}},[j]);let{data:w,isLoading:N}=L.h.analyze.performancePanel.useQuery({category:d,kpiIdFilter:p,productIdFilter:o}),P=null==j?void 0:j.kpisList.find(e=>e.id===p),{data:S}=L.h.analyze.electricity.useQuery({kpiIdFilter:p,productIdFilter:o},{enabled:(null==P?void 0:P.key)==="UseOfElectricity"}),{data:k}=L.h.analyze.waterComposition.useQuery({kpiIdFilter:p,productIdFilter:o},{enabled:(null==P?void 0:P.key)==="WaterFootprint"}),C=null==w?void 0:w.benchmark,I=null!==(t=null==w?void 0:w.selectedProductAmount)&&void 0!==t?t:0,K=null!==(l=null==P?void 0:P.unit)&&void 0!==l?l:"",E=null!==(i=null==w?void 0:w.totalKpi)&&void 0!==i?i:0,Z=v.length>0?v:null!==(r=null==w?void 0:w.activitiesList)&&void 0!==r?r:[],A=z.map(e=>{var a;let t=null==w?void 0:w.activityProductKpis.filter(a=>a.activity===e),l=null!==(a=null==t?void 0:t.reduce((e,a)=>e+a.totalValue,0))&&void 0!==a?a:0;return{activity:e,totalValue:l}}),V=A&&(null==A?void 0:A.length)>0?null==A?void 0:A.reduce((e,a)=>Z.find(e=>e===a.activity)?e+a.totalValue:e,0):E,F=A.reduce((e,a)=>e+Math.abs(a.totalValue),0),O=null==A?void 0:A.reduce((e,a)=>Z.find(e=>e===a.activity)?e+Math.abs(a.totalValue):e,0),D=Z.map(e=>{var a;let t=null!==(a=null==w?void 0:w.activityInputs.filter(a=>a.activity.activity===e))&&void 0!==a?a:[],l=[];t.forEach(e=>{l.some(a=>a.id===e.inputId)||l.push(e.input)});let s=l.map(e=>{let stagesKpi=a=>V?t.reduce((t,l)=>l.inputId===e.id?t+l[a]:t,0)/O*100:0;return{id:e.id,name:(0,_.i)(e.name,x),totalValue:stagesKpi("totalValue"),upstream:stagesKpi("upstream"),core:stagesKpi("core"),transportation:stagesKpi("transportation")}});return{activity:e,inputs:s}}),T=D.map(e=>e.inputs).flat().filter(e=>0!==e.totalValue).sort((e,a)=>Math.abs(a.totalValue)-Math.abs(e.totalValue)),B=V/I,R=C&&((P&&(0,c.JU)(P.key)?V:B)-C)/C*100,chartData=()=>{var e,a;return S?{data:S.classification.map(e=>({id:e.key,value:(0,h.N)(e.value)})),labels:S.classification.map(e=>m("electricity.".concat(e.key)))}:k?{data:k.footprints.map(e=>({id:e.key,value:(0,h.N)(e.value)})),labels:k.footprints.map(e=>m("waterFootprints.".concat(e.key)))}:{data:null!==(e=null==A?void 0:A.sort((e,a)=>Math.abs(a.totalValue)-Math.abs(e.totalValue)).map(e=>({id:e.activity,value:(0,h.N)(Math.abs(e.totalValue/F*100))})))&&void 0!==e?e:[],labels:null!==(a=null==A?void 0:A.sort((e,a)=>Math.abs(a.totalValue)-Math.abs(e.totalValue)).map(e=>m("filters.activity.".concat(e.activity))))&&void 0!==a?a:[]}},M={labels:chartData().labels,datasets:[{data:chartData().data}]},G=k&&{datasets:[{data:null==k?void 0:k.barChartData.map(e=>({label:m("waterComposition.".concat(e.key)).split("\n"),value:e.value}))}]},Q=null==S?void 0:S.electricitySources.map(e=>({name:(0,_.i)(e.name,x),value:e.value/E*100,id:e.id})).filter(e=>0!==e.value).sort((e,a)=>a.value-e.value);return{pageData:w,allActivities:z,electricityDataCard:Q,productsAndKpisList:j,isLoading:N||y,selectedActivities:v,setSelectedActivities:g,selectedKpiId:p,setSelectedKpiId:f,kpisListFilter:b,selectedKpi:P,listCardData:T,doughnutChartData:M,monitorCardValues:()=>{var e,a,t,l,s;let i={title:(0,_.i)(null!==(e=null==P?void 0:P.name)&&void 0!==e?e:[],x),amount:P&&(0,c.JU)(P.key)?V:B,unit:"".concat(K," ").concat(P&&(0,c.JU)(P.key)?"":" / ton"),variation:R},r=null==k?void 0:k.waterProductivity,n=null==r?void 0:r.benchmark,d=n&&((null!==(a=null==r?void 0:r.value)&&void 0!==a?a:0)-n)/n*100,o={title:(0,_.i)(null!==(t=null==r?void 0:r.name)&&void 0!==t?t:[],x),amount:null!==(l=null==r?void 0:r.value)&&void 0!==l?l:0,unit:"".concat(null!==(s=null==r?void 0:r.unit)&&void 0!==s?s:""),variation:d};return(null==P?void 0:P.key)==="WaterFootprint"?[i,o]:[i]},barChartData:G}};let Shimmer=()=>(0,l.jsxs)("div",{className:"h-full w-full",children:[(0,l.jsxs)(o.Zb,{className:"h-[137px] w-full px-4 py-3",children:[(0,l.jsx)(x.O,{className:"mb-2 h-7 w-[150px]"}),(0,l.jsxs)("div",{className:"flex gap-6",children:[(0,l.jsx)(x.O,{className:"h-7 w-full"}),(0,l.jsx)(x.O,{className:"h-7 w-full"}),(0,l.jsx)(x.O,{className:"h-7 w-full"})]}),(0,l.jsx)(m.Z,{className:"m-2 border-dashed border-gray-300"}),(0,l.jsxs)("div",{className:"flex gap-6",children:[(0,l.jsx)(x.O,{className:"h-7 w-full"}),(0,l.jsx)(x.O,{className:"h-7 w-full"}),(0,l.jsx)(x.O,{className:"h-7 w-full"})]})]}),(0,l.jsxs)("div",{className:"mt-4 flex h-full flex-col gap-4 lg:flex-row",children:[(0,l.jsxs)(o.Zb,{className:"w-full p-3 lg:w-2/3",children:[(0,l.jsx)(x.O,{className:"h-11 w-[150px]"}),(0,l.jsx)(m.Z,{className:"m-1 border-dashed border-gray-300"}),(0,l.jsxs)("div",{className:"flex h-[calc(100%_-_50px)] flex-col justify-between lg:flex-row",children:[(0,l.jsxs)("div",{className:"flex w-full flex-col justify-between",children:[(0,l.jsx)(x.O,{className:"h-[116px] w-full"}),(0,l.jsx)("div",{className:"hidden w-full lg:flex",children:(0,l.jsx)(x.O,{className:"h-[65px] w-full"})})]}),(0,l.jsx)("div",{className:"flex h-fit min-h-[300px] w-full items-center justify-center lg:h-[calc(100vh_-_435px)] lg:max-w-[75%]",children:(0,l.jsx)(d.Cd,{size:120,className:"animate-spin text-gray/200"})}),(0,l.jsx)("div",{className:"mt-7 w-[250px] lg:hidden",children:(0,l.jsx)(x.O,{className:"h-[65px]"})})]})]}),(0,l.jsxs)(o.Zb,{className:"flex h-[500px] min-h-[380px] flex-col gap-4 p-4 lg:h-[calc(100vh_-_358px)] lg:w-1/3",children:[(0,l.jsx)(x.O,{className:"h-10 w-full"}),(0,l.jsx)(x.O,{className:"h-10 w-full"}),(0,l.jsx)(x.O,{className:"h-10 w-full"}),(0,l.jsx)(x.O,{className:"h-10 w-full"}),(0,l.jsx)(x.O,{className:"h-10 w-full"}),(0,l.jsx)(x.O,{className:"h-10 w-full"}),(0,l.jsx)(x.O,{className:"h-10 w-full"})]})]})]});var analyze_PerformancePanel=e=>{let{category:a,selectedProductId:t,setSelectedProductId:s}=e,i=(0,n.useTranslations)(),{pageData:r,allActivities:d,electricityDataCard:x,productsAndKpisList:p,isLoading:h,selectedActivities:f,setSelectedActivities:v,selectedKpiId:g,setSelectedKpiId:y,kpisListFilter:b,selectedKpi:P,listCardData:S,doughnutChartData:k,monitorCardValues:C,barChartData:_}=hooks_usePerformancePanel({category:a,selectedProductId:t,setSelectedProductId:s});if(h||!p||!r)return(0,l.jsx)(Shimmer,{});if(0===p.productsList.length)return(0,l.jsx)("div",{className:"h-[calc(100vh_-_260px)] lg:h-[calc(100vh_-_210px)]",children:(0,l.jsx)(w.Z,{})});let I=(null==P?void 0:P.key)==="UseOfElectricity"||(null==P?void 0:P.key)==="WaterFootprint";return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(organisms_FiltersBar,{products:null==p?void 0:p.productsList,selectedProduct:t,setSelectedProduct:s,kpis:b,selectedKpiIds:g,setSelectedKpiIds:y,activities:d,selectedActivities:f,setSelectedActivities:v,disableActivityFilter:I,multiselect:!1}),(0,l.jsxs)("div",{className:"mt-4 flex h-full flex-col gap-4 lg:flex-row",children:[(0,l.jsxs)(o.Zb,{className:"w-full p-2 lg:min-w-[50%] lg:max-w-[70%]",children:[(0,l.jsx)(u.Z,{className:"ml-2 py-2",children:i("performancePerKpi.viewPanel.title")}),(0,l.jsx)(m.Z,{className:"m-1 border-dashed border-gray-300"}),(0,l.jsxs)("div",{className:"flex h-[calc(100%_-_50px)] flex-col justify-between xl:flex-row",children:[(0,l.jsxs)("div",{className:"flex w-[30%] flex-col justify-between",children:[(0,l.jsx)("div",{children:C().map((e,a)=>(0,l.jsx)(j.Z,{className:"h-fit p-2",title:e.title,amount:e.amount,unit:e.unit,enableFooter:!!e.variation,variation:e.variation,isCard:!1},a))}),(0,l.jsx)("div",{className:"hidden xl:flex",children:(0,l.jsx)(molecules_SustainableGoals,{category:a})})]}),(0,l.jsx)("div",{className:"flex h-fit w-full items-center xl:h-full xl:max-w-[70%]",children:(0,l.jsx)("div",{className:"min-h-[300px] w-full xl:h-[calc(100vh_-_435px)]",children:(0,l.jsx)(organisms_DoughnutChart,{chartData:k,selectedActivities:f})})}),(0,l.jsx)("div",{className:"mt-7 w-[250px] xl:hidden",children:(0,l.jsx)(molecules_SustainableGoals,{category:a})})]})]}),(null==P?void 0:P.key)!=="WaterFootprint"?(0,l.jsx)("div",{className:"h-fit lg:h-[600px] lg:min-w-[30%] xl:h-[calc(100vh_-_358px)] xl:min-h-[365px]",children:x?(0,l.jsx)(molecules_ListCard,{title:i("performancePerKpi.viewPanel.generationSources"),data:x,showStages:!1}):(0,l.jsx)(molecules_ListCard,{title:i("performancePerKpi.viewPanel.inputContribution"),data:S,showStages:!0})}):(0,l.jsxs)(o.Zb,{className:"min-w-[40%] p-2",children:[(0,l.jsxs)("div",{className:"ml-3",children:[(0,l.jsx)(u.Z,{children:i("performancePerKpi.viewPanel.hydricBalance")}),(0,l.jsxs)("p",{className:"text-[11px] text-gray/500",children:[i("performancePerKpi.viewPanel.inmm"),"."," ",i("performancePerKpi.viewPanel.campaign",{startDate:(0,c.UW)(r.organizationCampaign.startDate,i),endDate:(0,c.UW)(r.organizationCampaign.endDate,i)})]})]}),(0,l.jsx)(m.Z,{className:"m-1 border-dashed border-gray-300"}),(0,l.jsx)("div",{className:"min-h-[300px] lg:h-[calc(100%_-_50px)]",children:_&&(0,l.jsx)(N.Z,{chartData:_,barWidth:30,labelsSize:10})})]})]})]})},E=t(5186),hooks_usePerformanceStages=e=>{let{category:a,selectedProductId:t,setSelectedProductId:l}=e,i=(0,n.useLocale)(),[r,d]=(0,s.useState)([]),[c,o]=(0,s.useState)([]),{data:u,isLoading:m}=L.h.analyze.productsAndKpisList.useQuery({category:a});(0,s.useEffect)(()=>{if(u){if(!t){var e;l(null===(e=u.productsList[0])||void 0===e?void 0:e.id)}0===r.length&&d(u.kpisList.map(e=>e.id))}},[u]);let{data:x,isLoading:p}=L.h.analyze.performanceStages.useQuery({category:a,productIdFilter:t}),h=null==x?void 0:x.activityProductKpisByKpi.map(e=>{let a=e.activityProductKpis.reduce((e,a)=>e+Math.abs(a.totalValue),0),stageKpi=a=>e.activityProductKpis.reduce((e,t)=>e+t.activityInputs.reduce((e,t)=>e+Math.abs(t[a]),0),0);return{kpiId:e.kpiId,upstream:stageKpi("upstream")/a*100,core:stageKpi("core")/a*100,transportation:stageKpi("transportation")/a*100}}),f=null==x?void 0:x.activityProductKpisByKpi.map(e=>{let a=e.activityProductKpis.reduce((e,a)=>e+Math.abs(a.totalValue),0),stageKpi=a=>e.activityProductKpis.reduce((e,t)=>c.some(e=>e===t.activity)||0===c.length?e+t.activityInputs.reduce((e,t)=>e+Math.abs(t[a]),0):e,0);return{kpiId:e.kpiId,upstream:a>0?stageKpi("upstream")/a*100:0,core:a>0?stageKpi("core")/a*100:0,transportation:a>0?stageKpi("transportation")/a*100:0}}),v=null==u?void 0:u.kpisList.map(e=>({id:e.id,name:r.length>2?(0,_.i)(e.name,i).split(/[\s-]+/):(0,_.i)(e.name,i)})),generateStageDataset=e=>({datasets:[{data:r.map(a=>{var t,l,s,i;return{label:null!==(s=null==v?void 0:null===(t=v.find(e=>e.id===a))||void 0===t?void 0:t.name)&&void 0!==s?s:"",value:null!==(i=null==f?void 0:null===(l=f.find(e=>e.kpiId===a))||void 0===l?void 0:l[e])&&void 0!==i?i:0}})},{data:r.map(a=>{var t,l,s,i;return{label:null!==(s=null==v?void 0:null===(t=v.find(e=>e.id===a))||void 0===t?void 0:t.name)&&void 0!==s?s:"",value:null!==(i=null==h?void 0:null===(l=h.find(e=>e.kpiId===a))||void 0===l?void 0:l[e])&&void 0!==i?i:0}})}]}),g=generateStageDataset("upstream"),j=generateStageDataset("transportation"),y=generateStageDataset("core");return{pageData:x,productsAndKpisList:u,isLoading:m||p,selectedActivities:c,setSelectedActivities:o,selectedKpiIds:r,setSelectedKpiIds:d,stage1barChartData:g,stage2barChartData:j,stage3barChartData:y}};let ShimmerCardComponent=()=>(0,l.jsxs)(o.Zb,{className:"w-full p-4 lg:w-1/3",children:[(0,l.jsx)(x.O,{className:"h-10 w-full"}),(0,l.jsx)(m.Z,{className:"m-1 border-dashed border-gray-300"}),(0,l.jsx)("div",{className:"mt-2 h-[350px] w-full lg:h-[calc(100vh_-_440px)] lg:min-h-[260px]",children:(0,l.jsx)(x.O,{className:"h-full w-full"})})]}),PerformanceStages_Shimmer=()=>(0,l.jsxs)("div",{className:"h-full w-full",children:[(0,l.jsxs)(o.Zb,{className:"h-[137px] w-full px-4 py-3",children:[(0,l.jsx)(x.O,{className:"mb-2 h-7 w-[150px]"}),(0,l.jsxs)("div",{className:"flex gap-6",children:[(0,l.jsx)(x.O,{className:"h-7 w-full"}),(0,l.jsx)(x.O,{className:"h-7 w-full"}),(0,l.jsx)(x.O,{className:"h-7 w-full"})]}),(0,l.jsx)(m.Z,{className:"m-2 border-dashed border-gray-300"}),(0,l.jsxs)("div",{className:"flex gap-6",children:[(0,l.jsx)(x.O,{className:"h-7 w-full"}),(0,l.jsx)(x.O,{className:"h-7 w-full"}),(0,l.jsx)(x.O,{className:"h-7 w-full"})]})]}),(0,l.jsxs)("div",{className:"mt-4 flex flex-col gap-4 lg:flex-row",children:[(0,l.jsx)(ShimmerCardComponent,{}),(0,l.jsx)(ShimmerCardComponent,{}),(0,l.jsx)(ShimmerCardComponent,{})]})]}),CardComponent=e=>{let{title:a,barChartData:t,showArrows:s=!0,kpisSelected:i}=e,r=(0,n.useTranslations)();return(0,l.jsxs)(o.Zb,{className:"w-full overflow-hidden p-4 lg:w-1/3",children:[(0,l.jsxs)("div",{className:"flex w-full justify-between",children:[(0,l.jsxs)("div",{className:"flex w-[70%] flex-col",children:[(0,l.jsx)(u.Z,{className:"truncate",children:a}),(0,l.jsx)("p",{className:"truncate text-[11px] text-gray/500",children:r("performancePerKpi.viewStages.chartSubTitle")})]}),s&&(0,l.jsxs)("div",{className:"flex items-center justify-center ",children:[(0,l.jsx)(E.Djl,{className:"relative left-6 text-secondary",size:30}),(0,l.jsx)(E.Djl,{className:"relative left-3 text-secondary",size:30}),(0,l.jsx)(E.Djl,{className:"relative text-secondary",size:30})]})]}),(0,l.jsx)(m.Z,{className:"m-1 border-dashed border-gray-300"}),(0,l.jsx)("div",{className:"mt-2 h-[350px] w-full lg:h-[calc(100vh_-_440px)] lg:min-h-[260px]",children:i?(0,l.jsx)(N.Z,{maxYValue:100,labelsSize:9,barWidth:30,chartData:t,unit:"%"}):(0,l.jsx)("div",{className:"flex h-full w-full items-center justify-center rounded-lg border border-gray/200 bg-gray/100",children:(0,l.jsx)("p",{className:"text-sm text-gray/500",children:r("performancePerKpi.viewStages.pleaseSelectKpi")})})})]})};var analyze_PerformanceStages=e=>{let{category:a,selectedProductId:t,setSelectedProductId:s}=e,i=(0,n.useTranslations)(),{pageData:r,productsAndKpisList:d,isLoading:c,selectedActivities:o,setSelectedActivities:u,selectedKpiIds:m,setSelectedKpiIds:x,stage1barChartData:p,stage2barChartData:h,stage3barChartData:f}=hooks_usePerformanceStages({category:a,selectedProductId:t,setSelectedProductId:s});return!c&&d&&r?0===d.productsList.length?(0,l.jsx)("div",{className:"h-[calc(100vh_-_260px)] lg:h-[calc(100vh_-_210px)]",children:(0,l.jsx)(w.Z,{})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(organisms_FiltersBar,{products:d.productsList,selectedProduct:t,setSelectedProduct:s,kpis:d.kpisList,selectedKpiIds:m,setSelectedKpiIds:x,activities:z,selectedActivities:o,setSelectedActivities:u,multiselect:!0}),(0,l.jsxs)("div",{className:"mt-4 flex w-full flex-col gap-4 lg:flex-row",children:[(0,l.jsx)(CardComponent,{title:i("performancePerKpi.viewStages.step1Title"),barChartData:p,kpisSelected:0!==m.length},"stage-1-".concat(m.length)),(0,l.jsx)(CardComponent,{title:i("performancePerKpi.viewStages.step2Title"),barChartData:h,kpisSelected:0!==m.length},"stage-2-".concat(m.length)),(0,l.jsx)(CardComponent,{title:i("performancePerKpi.viewStages.step3Title"),barChartData:f,showArrows:!1,kpisSelected:0!==m.length},"stage-3-".concat(m.length))]})]}):(0,l.jsx)(PerformanceStages_Shimmer,{})},Z=t(3197);let PerofrmancePage=()=>{let[e,a]=(0,s.useState)("climateChange"),[t,n]=(0,s.useState)("viewPanel"),[d,c]=(0,s.useState)();return(0,l.jsx)(r.Z,{switchTabs:(0,l.jsx)(i.Z,{key1:"viewPanel",key2:"viewStages",setSelected:n,defaultValue:"viewPanel"}),selectedTab:e,setSelectedTab:a,tabs:[{key:"climateChange",content:"viewPanel"===t?(0,l.jsx)(analyze_PerformancePanel,{category:"ClimateChange",setSelectedProductId:c,selectedProductId:d}):(0,l.jsx)(analyze_PerformanceStages,{category:"ClimateChange",setSelectedProductId:c,selectedProductId:d})},{key:"ecosystemQuality",content:"viewPanel"===t?(0,l.jsx)(analyze_PerformancePanel,{category:"EcosystemQuality",setSelectedProductId:c,selectedProductId:d}):(0,l.jsx)(analyze_PerformanceStages,{category:"EcosystemQuality",setSelectedProductId:c,selectedProductId:d})},{key:"humanHealth",content:"viewPanel"===t?(0,l.jsx)(analyze_PerformancePanel,{category:"HumanHealth",setSelectedProductId:c,selectedProductId:d}):(0,l.jsx)(analyze_PerformanceStages,{category:"HumanHealth",setSelectedProductId:c,selectedProductId:d})},{key:"resourcesExhaustion",content:"viewPanel"===t?(0,l.jsx)(analyze_PerformancePanel,{category:"ResourcesExhaustion",setSelectedProductId:c,selectedProductId:d}):(0,l.jsx)(analyze_PerformanceStages,{category:"ResourcesExhaustion",setSelectedProductId:c,selectedProductId:d})}]})};PerofrmancePage.getLayout=e=>(0,l.jsx)(Z.Z,{titleKey:"performancePerKpi",children:e});var A=!0,V=PerofrmancePage},3411:function(e,a,t){"use strict";t.d(a,{N:function(){return round}});let round=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return 1e6>Math.abs(e)&&Math.abs(e)>=1||0===e?e.toLocaleString("en",{minimumFractionDigits:a,maximumFractionDigits:a}):t?"< 1.0":e.toExponential(2)}}},function(e){e.O(0,[235,917,525,461,898,713,872,767,278,424,612,512,535,372,965,784,641,774,888,179],function(){return e(e.s=9354)}),_N_E=e.O()}]);