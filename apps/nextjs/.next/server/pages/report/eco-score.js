"use strict";(()=>{var e={};e.id=4012,e.ids=[4012,2888,660],e.modules={6179:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{config:()=>g,default:()=>p,getServerSideProps:()=>h,getStaticPaths:()=>m,getStaticProps:()=>u,reportWebVitals:()=>j,routeModule:()=>v,unstable_getServerProps:()=>S,unstable_getServerSideProps:()=>w,unstable_getStaticParams:()=>_,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>f});var a=t(8877),l=t(4591),c=t(6021),o=t(1938),i=t.n(o),n=t(4801),d=t(1869),x=e([n,d]);[n,d]=x.then?(await x)():x;let p=(0,c.l)(d,"default"),u=(0,c.l)(d,"getStaticProps"),m=(0,c.l)(d,"getStaticPaths"),h=(0,c.l)(d,"getServerSideProps"),g=(0,c.l)(d,"config"),j=(0,c.l)(d,"reportWebVitals"),f=(0,c.l)(d,"unstable_getStaticProps"),b=(0,c.l)(d,"unstable_getStaticPaths"),_=(0,c.l)(d,"unstable_getStaticParams"),S=(0,c.l)(d,"unstable_getServerProps"),w=(0,c.l)(d,"unstable_getServerSideProps"),v=new a.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/report/eco-score",pathname:"/report/eco-score",bundlePath:"",filename:""},components:{App:n.default,Document:i()},userland:d});s()}catch(e){s(e)}})},5207:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var a=t(997),l=t(951),c=t(6391),o=e([c]);c=(o.then?(await o)():o)[0];let __WEBPACK_DEFAULT_EXPORT__=({text:e})=>(0,a.jsxs)(c.Zb,{className:"flex items-center gap-x-4 rounded-xl border border-info_16 bg-info_8 p-2 px-4 shadow-none",children:[a.jsx(l.kA6,{className:"text-info",size:24}),a.jsx("p",{className:"whitespace-pre-line text-xs font-semibold text-info/dark",children:e})]});s()}catch(e){s(e)}})},3230:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var a=t(997),l=t(503),c=t(951),o=t(6391),i=e([o]);o=(i.then?(await i)():i)[0];let __WEBPACK_DEFAULT_EXPORT__=()=>{let e=(0,l.useTranslations)();return(0,a.jsxs)(o.Zb,{className:"flex h-full flex-col items-center justify-center border border-info_16 bg-info_8 p-4 shadow-none",children:[a.jsx(c.kA6,{className:"mb-2 text-info",size:24}),a.jsx("p",{className:"whitespace-pre-line text-center text-sm font-semibold text-info/dark",children:e("uncompletedCampaign.title")})]})};s()}catch(e){s(e)}})},3436:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var a=t(997),l=t(503),c=t(5819),o=t(857),i=t(8293),n=t(6391),d=t(1267),x=t(2428),p=t(8590),u=e([i,n,d,x,p]);[i,n,d,x,p]=u.then?(await u)():u;let m=[{letter:"E",lowerBound:null,upperBound:15},{letter:"D",lowerBound:15,upperBound:40},{letter:"C",lowerBound:40,upperBound:70},{letter:"B",lowerBound:70,upperBound:90},{letter:"A",lowerBound:90,upperBound:null}],h={A:"bg-success/light",B:"bg-success",C:"bg-warning",D:"bg-error",E:"bg-error/dark"},getRange=(e,r)=>{if(null===e){if(null===r)throw Error("Both lower and upper bounds cannot be null");return{text:`< ${r}%`,width:r}}return null===r?{text:`> ${e}%`,width:100-e}:{text:`${e}% - ${r}%`,width:r-e}},EcoScoreSection=({letter:e,lowerBound:r,upperBound:t,className:s})=>{let l=h[e],{text:c,width:o}=getRange(r,t);return(0,a.jsxs)("div",{className:(0,i.cn)("flex h-full flex-col items-center justify-center gap-1 text-white",l,s),style:{width:`${o}%`},children:[a.jsx("p",{className:"text-base font-semibold lg:text-lg",children:e}),a.jsx("p",{className:"text-xs lg:text-base",children:c})]})},EcoScoreGraph=({percentage:e})=>(0,a.jsxs)(x.x,{className:"w-full max-w-5xl",children:[a.jsx("div",{className:"h-fit w-full pb-9 pt-4 lg:pt-9",children:(0,a.jsxs)("div",{className:"relative flex h-16 w-full rounded-md lg:h-20 lg:min-w-[600px]",children:[m.map((e,r)=>a.jsx(EcoScoreSection,{...e,className:(0,i.cn)(0===r&&"rounded-l-md",r===m.length-1&&"rounded-r-md")},e.letter)),a.jsx(EcoScoreTooltip,{percentage:e})]})}),a.jsx(x.B,{orientation:"horizontal"})]}),GradingLetter=({letter:e})=>a.jsx("div",{className:(0,i.cn)("flex h-16 w-16 items-center justify-center rounded-lg text-2xl font-bold text-white lg:h-20 lg:w-20 lg:min-w-[80px] lg:text-4xl",h[e]),children:e}),EcoScoreTooltip=({percentage:e})=>{let r=`${e.toFixed(1)}%`,t={width:10*r.length,left:`calc(${e}% - 25px)`};return(0,a.jsxs)(a.Fragment,{children:[a.jsx(c.RPR,{size:25,className:"absolute bottom-[-16px] text-black",style:t}),a.jsx("div",{className:"absolute bottom-[-30px]",style:t,children:a.jsx("p",{className:"rounded-sm bg-black p-1 text-center text-xs text-white",children:r})})]})},__WEBPACK_DEFAULT_EXPORT__=({percentage:e,grade:r,campaign:t,productName:s})=>{let c=(0,l.useTranslations)(),i=(0,l.useLocale)();return(0,a.jsxs)(n.Zb,{className:"h-full p-4",children:[(0,a.jsxs)("div",{className:"pb-2",children:[a.jsx(d.Z,{children:c("report.ecoScore.resultsTitle",{productName:s?`- ${(0,o.i)(s,i)}`:void 0})}),a.jsx("p",{className:"text-xs font-light text-gray/600",children:c("report.ecoScore.campaignPeriod",{...t})}),a.jsx(p.Z,{className:"mt-3 border-dashed border-gray/300"})]}),(0,a.jsxs)("div",{className:"mt-4 flex h-[calc(100%_-_60px)] w-full flex-col items-center justify-center px-10 lg:mt-0 lg:flex-row lg:gap-20",children:[a.jsx(GradingLetter,{letter:r}),a.jsx(EcoScoreGraph,{percentage:e})]})]})};s()}catch(e){s(e)}})},4707:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.d(r,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var a=t(997),l=t(6689),c=t.n(l),o=t(503),i=t(857),n=t(3411),d=t(8293),x=t(1267),p=t(2428),u=t(8590),m=e([d,x,p,u]);[d,x,p,u]=m.then?(await m)():m;let h={A:"text-success/light",B:"text-success",C:"text-warning",D:"text-error",E:"text-error/dark"},__WEBPACK_DEFAULT_EXPORT__=({tableData:e})=>{let r=(0,o.useTranslations)(),t=(0,o.useLocale)();return(0,a.jsxs)("div",{className:"h-full",children:[a.jsx(x.Z,{children:r("report.ecoScore.resultsSummary")}),a.jsx(u.Z,{className:"mb-5 mt-3 border-dashed border-gray/300"}),(0,a.jsxs)("div",{className:"mb-2 grid w-full grid-cols-5 place-items-center bg-gray/100 p-2 text-sm font-semibold",children:[a.jsx("p",{children:r("report.ecoScore.table.area")}),a.jsx("p",{children:r("report.ecoScore.table.indicator")}),a.jsx("p",{children:r("report.ecoScore.table.result")}),a.jsx("p",{children:r("report.ecoScore.table.score")}),a.jsx("p",{children:r("report.ecoScore.table.previousCampaign")})]}),a.jsx(p.x,{className:"h-[calc(100%_-_100px)]",children:e.map(e=>(0,a.jsxs)(c().Fragment,{children:[(0,a.jsxs)("div",{className:"grid w-full grid-cols-5 place-items-center p-2 text-center text-sm text-gray/500",children:[a.jsx("p",{style:{gridRowStart:1,gridRowEnd:e.kpiResults.length+1},children:r(`kpiCategory.${e.categoryKey}`)}),e.kpiResults.map(e=>(0,a.jsxs)(c().Fragment,{children:[a.jsx("p",{children:(0,i.i)(e.kpiName,t)}),a.jsx("p",{className:(0,d.cn)("font-medium",h[e.ecoScoreGrade]),children:`${(0,n.N)(e.ecoScoreValue,1,!0)}%`}),a.jsx("p",{className:(0,d.cn)("font-medium",h[e.ecoScoreGrade]),children:e.ecoScoreGrade}),a.jsx("p",{children:e.previousCampaignGrade??"-"})]},e.kpiId))]}),a.jsx(u.Z,{className:"my-1 border-dashed border-gray/300"})]},e.categoryKey))})]})};s()}catch(e){s(e)}})},1869:(e,r,t)=>{t.a(e,async(e,s)=>{try{t.r(r),t.d(r,{default:()=>v,getServerSideProps:()=>getServerSideProps});var a=t(997),l=t(6689),c=t(503),o=t(4271),i=t(857),n=t(261),d=t(2948),x=t(6391),p=t(1267),u=t(7936),m=t(8590),h=t(6068),g=t(5207),j=t(3230),f=t(3436),b=t(4707),_=t(6697),S=t(2836),w=e([o,x,p,u,m,h,g,j,f,b,_,S]);[o,x,p,u,m,h,g,j,f,b,_,S]=w.then?(await w)():w;let Shimmer=()=>{let e=(0,c.useTranslations)();return(0,a.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[a.jsx(p.Z,{className:"font-secondary text-2xl",children:e("pageTitles.ecoScore")}),(0,a.jsxs)(x.Zb,{className:"flex h-[289px] flex-col p-4 lg:h-[245px]",children:[(0,a.jsxs)("div",{className:"pb-2",children:[a.jsx(h.O,{className:"mb-2 h-[25px] w-[250px]"}),a.jsx(h.O,{className:"h-5 w-[200px]"}),a.jsx(m.Z,{className:"mt-3 border-dashed border-gray/300"})]}),a.jsx("div",{className:"mt-4 flex h-full w-full items-center justify-center",children:a.jsx(h.O,{className:"h-20 w-full max-w-[80%]"})})]}),a.jsx("div",{className:"flex h-[calc(100vh_-_460px)] flex-col gap-2 lg:h-[calc(100vh_-_420px)]",children:(0,a.jsxs)(x.Zb,{className:"h-full p-4",children:[a.jsx(h.O,{className:"mb-2 h-[25px] w-[250px]"}),a.jsx(m.Z,{className:"mb-5 mt-3 border-dashed border-gray/300"}),(0,a.jsxs)("div",{className:"mb-2 grid w-full grid-cols-5 place-items-center bg-gray/100 p-2 text-sm font-semibold",children:[a.jsx("p",{children:e("report.ecoScore.table.area")}),a.jsx("p",{children:e("report.ecoScore.table.indicator")}),a.jsx("p",{children:e("report.ecoScore.table.result")}),a.jsx("p",{children:e("report.ecoScore.table.score")}),a.jsx("p",{children:e("report.ecoScore.table.previousCampaign")})]}),a.jsx("div",{className:"mb-2 grid w-full grid-cols-5 place-items-center p-2",children:Array.from({length:15}).map((e,r)=>a.jsx(h.O,{className:"my-2 h-7 w-2/3"},r))})]})})]})},EcoScorePage=()=>{let e=(0,c.useTranslations)(),r=(0,c.useLocale)(),[t,s]=(0,l.useState)(),[d,m]=(0,l.useState)(),{data:h,isLoading:_}=o.h.report.productsAndCampaignsList.useQuery();(0,l.useEffect)(()=>{h&&!t&&s(h[0]?.id)},[h]);let{data:S,isLoading:w}=o.h.report.ecoScoreData.useQuery({organizationCampaignId:t,productId:d},{enabled:!!t}),v=h?.find(e=>e.id===t),N=v?.products,y=N?.length??0,P=v?.totalProducts??0;return N?.length===0?(0,a.jsxs)(a.Fragment,{children:[a.jsx(p.Z,{className:"mb-4 font-secondary text-2xl",children:e("pageTitles.ecoScore")}),a.jsx("div",{className:"h-[calc(100vh_-_160px)]",children:a.jsx(j.Z,{})})]}):_||w?a.jsx(Shimmer,{}):(0,a.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[a.jsx(p.Z,{className:"font-secondary text-2xl",children:e("pageTitles.ecoScore")}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(u.Ph,{onValueChange:e=>s(e),value:t,children:[a.jsx(u.i4,{className:"h-7 w-1/2 border-gray/500 text-xs text-gray/500 lg:w-[200px]",children:a.jsx(u.ki,{placeholder:e("report.ecoScore.selectCampaign")})}),a.jsx(u.Bw,{children:h?.map(r=>a.jsx(u.Ql,{value:r.id,children:a.jsxs("p",{children:[n.UW(r.startDate,e)," - ",n.UW(r.endDate,e)]})},r.id))})]}),(0,a.jsxs)(u.Ph,{onValueChange:e=>"allProducts"===e?m(void 0):m(e),value:d,children:[a.jsx(u.i4,{className:"h-7 w-1/2 border-gray/500 text-xs text-gray/500 lg:w-[200px]",children:a.jsx(u.ki,{placeholder:e("report.ecoScore.allProducts")})}),(0,a.jsxs)(u.Bw,{children:[a.jsx(u.Ql,{value:"allProducts",children:a.jsx("p",{children:e("report.ecoScore.allProducts")})},"allProducts"),N?.map(e=>a.jsx(u.Ql,{value:e.id,children:a.jsx("p",{children:i.i(e.name,r)})},e.id))]})]},d)]})]}),S?.totalEcoScore&&v&&a.jsx(f.Z,{productName:N?.find(e=>e.id===d)?.name,grade:S?.totalEcoScore?.ecoScoreGrade,percentage:S.totalEcoScore.ecoScoreValue,campaign:{startDate:(0,n.UW)(v?.startDate,e),endDate:(0,n.UW)(v?.endDate,e)}}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 lg:h-[calc(100vh_-_420px)]",children:[a.jsx(x.Zb,{className:"flex-1 overflow-hidden p-4",children:S?.kpiEcoScores&&a.jsx(b.Z,{tableData:S.kpiEcoScores})}),!d&&y!==P&&a.jsx(g.Z,{text:e("report.ecoScore.informationCard",{listedProducts:y,totalProducts:P})})]})]})};EcoScorePage.getLayout=e=>a.jsx(_.Z,{children:e});let getServerSideProps=async e=>{let r=await (0,S.x)(e);return await r.report.productsAndCampaignsList.prefetch(),{props:{trpcState:r.dehydrate(),messages:await (0,d.E)(e.locale)}}},v=EcoScorePage;s()}catch(e){s(e)}})},1841:e=>{e.exports=require("@aws-sdk/client-s3")},4298:e=>{e.exports=require("@aws-sdk/client-ses")},3303:e=>{e.exports=require("@paralleldrive/cuid2")},3524:e=>{e.exports=require("@prisma/client")},7620:e=>{e.exports=require("@radix-ui/react-avatar")},3363:e=>{e.exports=require("@radix-ui/react-dialog")},8532:e=>{e.exports=require("@radix-ui/react-dropdown-menu")},4034:e=>{e.exports=require("@radix-ui/react-select")},2479:e=>{e.exports=require("@radix-ui/react-toast")},8432:e=>{e.exports=require("bcryptjs")},8103:e=>{e.exports=require("clsx")},9344:e=>{e.exports=require("jsonwebtoken")},3227:e=>{e.exports=require("next-auth")},7449:e=>{e.exports=require("next-auth/providers/credentials")},1649:e=>{e.exports=require("next-auth/react")},503:e=>{e.exports=require("next-intl")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},5184:e=>{e.exports=require("nodemailer")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},72:e=>{e.exports=require("superjson")},1656:e=>{e.exports=import("@hookform/resolvers/zod")},7412:e=>{e.exports=import("@radix-ui/react-accordion")},49:e=>{e.exports=import("@radix-ui/react-label")},307:e=>{e.exports=import("@radix-ui/react-scroll-area")},7717:e=>{e.exports=import("@react-email/components")},846:e=>{e.exports=import("@react-email/font")},4116:e=>{e.exports=import("@react-email/head")},8816:e=>{e.exports=import("@react-email/render")},3594:e=>{e.exports=import("@t3-oss/env-core")},6206:e=>{e.exports=import("@t3-oss/env-nextjs")},272:e=>{e.exports=import("@trpc/client")},7455:e=>{e.exports=import("@trpc/next")},5468:e=>{e.exports=import("@trpc/react-query/server")},2937:e=>{e.exports=import("@trpc/server")},6926:e=>{e.exports=import("class-variance-authority")},5641:e=>{e.exports=import("react-hook-form")},8097:e=>{e.exports=import("tailwind-merge")},9926:e=>{e.exports=import("zod")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var r=require("../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[1938,8724,7457,5632,5487,9244,6983,4801,2876,1172,3833,2836,6391],()=>__webpack_exec__(6179));module.exports=t})();