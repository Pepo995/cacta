"use strict";(()=>{var e={};e.id=7664,e.ids=[7664,2888,660],e.modules={544:(e,s,a)=>{a.a(e,async(e,t)=>{try{a.r(s),a.d(s,{config:()=>g,default:()=>m,getServerSideProps:()=>h,getStaticPaths:()=>x,getStaticProps:()=>u,reportWebVitals:()=>f,routeModule:()=>N,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>v,unstable_getStaticParams:()=>w,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>j});var r=a(8877),l=a(4591),i=a(6021),c=a(1938),n=a.n(c),o=a(4801),d=a(6882),p=e([o,d]);[o,d]=p.then?(await p)():p;let m=(0,i.l)(d,"default"),u=(0,i.l)(d,"getStaticProps"),x=(0,i.l)(d,"getStaticPaths"),h=(0,i.l)(d,"getServerSideProps"),g=(0,i.l)(d,"config"),f=(0,i.l)(d,"reportWebVitals"),j=(0,i.l)(d,"unstable_getStaticProps"),b=(0,i.l)(d,"unstable_getStaticPaths"),w=(0,i.l)(d,"unstable_getStaticParams"),y=(0,i.l)(d,"unstable_getServerProps"),v=(0,i.l)(d,"unstable_getServerSideProps"),N=new r.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/monitor/summary-by-establishment",pathname:"/monitor/summary-by-establishment",bundlePath:"",filename:""},components:{App:o.default,Document:n()},userland:d});t()}catch(e){t(e)}})},8912:(e,s,a)=>{a.a(e,async(e,t)=>{try{a.d(s,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var r=a(997),l=a(6689),i=a(2433),c=a(7716),n=a(503),o=a(5803),d=a(6391),p=a(7936),m=e([o,d,p]);[o,d,p]=m.then?(await m)():m;let u=["drawing","elevation"],__WEBPACK_DEFAULT_EXPORT__=({establishments:e,selectedEstablishment:s,setSelectedEstablishment:a})=>{let t=(0,n.useTranslations)(),[m,x]=(0,l.useState)(null),[h,g]=(0,l.useState)(null),f=(0,l.useRef)(s?.id),{isLoaded:j}=(0,i.useLoadScript)({googleMapsApiKey:o.O.NEXT_PUBLIC_MAPS_API_KEY,libraries:u}),handleSelectionChange=s=>{if(f.current=s,"allEstablishments"===s)return a(void 0);let t=e.find(e=>e.id===f.current);a(t)},handleMarkerClick=(e,s,a,t)=>{g({id:e,name:s,latitude:a,longitude:t,clicked:!0}),handleSelectionChange(e)},getMarkers=()=>s?[s]:e;return(0,l.useEffect)(()=>{if(m){let e=new window.google.maps.LatLngBounds;getMarkers().map(({latitude:s,longitude:a})=>{e.extend({lat:s,lng:a})}),m.fitBounds(e,40)}},[m,e,s]),(0,r.jsxs)(d.Zb,{className:"flex max-h-[800px] flex-grow flex-col gap-6 p-6",children:[(0,r.jsxs)(p.Ph,{value:f.current,onValueChange:handleSelectionChange,children:[r.jsx(p.i4,{className:"h-[40px] w-full",children:r.jsx(p.ki,{placeholder:t("map.allEstablishments")})}),(0,r.jsxs)(p.Bw,{children:[r.jsx(p.Ql,{value:"allEstablishments",children:t("map.allEstablishments")}),e.map(({name:e,id:s},a)=>r.jsx(p.Ql,{value:s,children:e},a))]})]}),r.jsx("div",{className:"flex h-full w-full items-center justify-center",children:j?r.jsx(i.GoogleMap,{mapContainerClassName:"h-full w-full min-h-[200px]",onLoad:e=>{e.setOptions({maxZoom:10}),x(e)},children:getMarkers().map(({id:e,name:s,latitude:a,longitude:t},l)=>r.jsx(i.MarkerF,{onMouseOver:()=>!h?.clicked&&g({id:e,name:s,latitude:a,longitude:t,clicked:!1}),onMouseOut:()=>!h?.clicked&&g(null),onClick:()=>handleMarkerClick(e,s,a,t),position:{lat:a,lng:t},icon:{url:"/icons/location-pin.svg"},children:h?.id===e&&r.jsx(i.InfoWindowF,{onCloseClick:()=>{g(null),handleSelectionChange("allEstablishments")},position:{lat:a,lng:t},children:r.jsx("p",{children:s})})},l))}):r.jsx(c.Z,{className:"animate-spin",size:20})})]})};t()}catch(e){t(e)}})},3346:(e,s,a)=>{a.a(e,async(e,t)=>{try{a.d(s,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var r=a(997),l=a(503),i=a(3411),c=a(6391),n=a(1267),o=a(2428),d=e([c,n,o]);[c,n,o]=d.then?(await d)():d;let __WEBPACK_DEFAULT_EXPORT__=({area:e,crops:s,latitude:a,longitude:t,soilType:d,ph:p,organicMaterial:m,nitrogen:u,phosphorus:x})=>{let h=(0,l.useTranslations)();return(0,r.jsxs)(c.Zb,{className:"flex flex-col justify-between gap-10 p-4 font-secondary lg:flex-row",children:[(0,r.jsxs)("div",{className:"min-w-[200px] lg:w-1/2 lg:max-w-[400px]",children:[r.jsx(n.Z,{className:"mb-4 text-lg",children:h("cards.metricsCard.landMetrics")}),(0,r.jsxs)("div",{className:"w-full text-sm 2xl:text-base",children:[(0,r.jsxs)("div",{className:"mb-1 flex border-b border-muted font-bold",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.parameter")}),r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.value")})]}),(0,r.jsxs)("div",{className:"flex pt-2",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.totalArea")}),r.jsx("p",{className:"w-1/2 whitespace-nowrap",children:(0,r.jsxs)(o.x,{children:[e?`${(0,i.N)(e)} ha`:"-",r.jsx(o.B,{orientation:"horizontal"})]})})]}),s.sort((e,s)=>s.cropArea-e.cropArea).slice(0,3).map(e=>(0,r.jsxs)("div",{className:"flex pt-2 text-sm text-gray/600",children:[r.jsx("p",{className:"w-1/2",children:r.jsx("li",{children:e.cropName})}),r.jsx("p",{className:"w-1/2 whitespace-nowrap",children:(0,r.jsxs)(o.x,{children:[(0,i.N)(e.cropArea)," ha",r.jsx(o.B,{orientation:"horizontal"})]})})]},e.cropName)),(0,r.jsxs)("div",{className:"flex pt-2",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.latitude")}),r.jsx("p",{className:"w-1/2 whitespace-nowrap",children:(0,r.jsxs)(o.x,{children:[a??"-",r.jsx(o.B,{orientation:"horizontal"})]})})]}),(0,r.jsxs)("div",{className:"flex pt-2",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.longitude")}),r.jsx("p",{className:"w-1/2 whitespace-nowrap",children:(0,r.jsxs)(o.x,{children:[t??"-",r.jsx(o.B,{orientation:"horizontal"})]})})]})]})]}),(0,r.jsxs)("div",{className:"min-w-[200px] lg:w-1/2 lg:max-w-[400px]",children:[r.jsx(n.Z,{className:"mb-4 text-lg",children:h("cards.metricsCard.environmentalMetrics")}),(0,r.jsxs)("div",{className:"w-full text-sm 2xl:text-base",children:[(0,r.jsxs)("div",{className:"mb-1 flex border-b border-muted font-bold",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.parameter")}),r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.value")})]}),(0,r.jsxs)("div",{className:"flex pt-2",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.soilType")}),r.jsx("p",{className:"w-1/2 whitespace-nowrap",children:(0,r.jsxs)(o.x,{children:[d??"-",r.jsx(o.B,{orientation:"horizontal"})]})})]}),(0,r.jsxs)("div",{className:"flex pt-2",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.soilPh")}),r.jsx("p",{className:"w-1/2",children:r.jsx(o.x,{children:p?(0,i.N)(p):"-"})})]}),(0,r.jsxs)("div",{className:"flex pt-2",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.organicMaterial")}),r.jsx("p",{className:"w-1/2",children:r.jsx(o.x,{children:m?`${(0,i.N)(m)} %`:"-"})})]}),(0,r.jsxs)("div",{className:"flex pt-2",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.nitrogen")}),r.jsx("p",{className:"w-1/2",children:r.jsx(o.x,{children:u?`${(0,i.N)(u)} %`:"-"})})]}),(0,r.jsxs)("div",{className:"flex pt-2",children:[r.jsx("p",{className:"w-1/2",children:h("cards.metricsCard.phosphorus")}),r.jsx("p",{className:"w-1/2",children:r.jsx(o.x,{children:x?`${(0,i.N)(x)} ppm`:"-"})})]})]})]})]})};t()}catch(e){t(e)}})},7200:(e,s,a)=>{a.a(e,async(e,t)=>{try{a.d(s,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var r=a(997),l=a(503),i=a(857),c=a(261),n=a(6391),o=a(6068),d=a(647),p=a(5207),m=a(8912),u=a(3346),x=a(486),h=a(3230),g=a(9868),f=a(8293),j=e([n,o,d,p,m,u,x,h,g,f]);[n,o,d,p,m,u,x,h,g,f]=j.then?(await j)():j;let Shimmer=()=>(0,r.jsxs)("div",{className:"flex h-full flex-col gap-3 lg:flex-row",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-3 lg:w-[60%]",children:[r.jsx(n.Zb,{className:"w-full p-4",children:r.jsx(o.O,{className:"h-[100px]"})}),r.jsx(n.Zb,{className:"w-full p-4",children:r.jsx(o.O,{className:"h-[100px]"})}),(0,r.jsxs)(n.Zb,{className:"flex flex-col justify-between gap-10 p-4 font-secondary sm:flex-row",children:[(0,r.jsxs)("div",{className:"sm:w-1/2",children:[r.jsx(o.O,{className:"mb-4 h-[25px]"}),r.jsx(o.O,{className:"h-[200px]"})]}),(0,r.jsxs)("div",{className:"sm:w-1/2",children:[r.jsx(o.O,{className:"mb-4 h-[25px]"}),r.jsx(o.O,{className:"h-[200px]"})]})]})]}),(0,r.jsxs)(n.Zb,{className:"flex flex-col gap-4 p-4 lg:w-[40%]",children:[r.jsx(o.O,{className:"h-[40px] w-full"}),r.jsx(o.O,{className:"h-full min-h-[250px] w-full"})]})]}),__WEBPACK_DEFAULT_EXPORT__=({selectedSwitchTab:e,category:s,showScopes:a=!1,selectedEstablishment:t,setSelectedEstablishment:o})=>{let j=(0,l.useLocale)(),b=(0,l.useTranslations)(),{filteredData:w,toDMS:y,pageDataLoading:v,establishmentsCampaign:N,showOngoingCampaign:_,noFinishedCampaigns:E}=(0,g.Z)({category:s,selectedEstablishment:t});return!v&&N&&w?E()?r.jsx("div",{className:"h-[calc(100vh_-_260px)] lg:h-[calc(100vh_-_210px)]",children:r.jsx(h.Z,{})}):(0,r.jsxs)("div",{className:"flex h-full flex-col gap-3 lg:flex-row",children:[(0,r.jsxs)("div",{className:"flex w-full flex-col gap-3 lg:w-[60%]",children:[r.jsx("div",{className:(0,f.cn)("grid gap-1",w.kpiValues.length>1&&"lg:grid-cols-2"),children:w.kpiValues.filter(e=>"WaterProductivity"!==e.key).map(({name:s,value:a,id:t,unit:l,key:n})=>r.jsx(x.Z,{amount:"absolute"===e||(0,c.JU)(n)?a:a/w.totalHarvestedArea,unit:"absolute"===e||(0,c.JU)(n)?l:`${l} / ha `,enableFooter:!1,title:(0,i.i)(s,j)},t))}),a&&r.jsx(n.Zb,{className:"w-full p-4",children:r.jsx(d.Z,{items:[{name:"S1",value:w?.scopes?.scope1??0},{name:"S2",value:w?.scopes?.scope2??0},{name:"S3",value:w?.scopes?.scope3??0}],showInformation:!0})}),r.jsx(u.Z,{area:w.area,crops:w.products.map(e=>({cropName:(0,i.i)(e.name,j),cropArea:e.area})),latitude:y(w.latitude,!1),longitude:y(w.longitude,!0),soilType:w.soilType,ph:w.soilPH??void 0,organicMaterial:w.organicMaterial??void 0,nitrogen:w.nitrogen??void 0,phosphorus:w.phosphorous??void 0})]}),(0,r.jsxs)("div",{className:"flex w-full flex-col gap-2 lg:w-[40%]",children:[r.jsx(m.Z,{selectedEstablishment:t,setSelectedEstablishment:o,establishments:N.map(({establishment:e,establishmentId:s})=>({id:s,name:e.name,latitude:e.latitude,longitude:e.longitude}))}),_()&&r.jsx(p.Z,{text:b("monitor.summaryByProduct.ongoingCampaignMessage")})]})]}):r.jsx(Shimmer,{})};t()}catch(e){t(e)}})},9868:(e,s,a)=>{a.a(e,async(e,t)=>{try{a.d(s,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var r=a(6689),l=a(4271),i=e([l]);l=(i.then?(await i)():i)[0];let __WEBPACK_DEFAULT_EXPORT__=({category:e,selectedEstablishment:s})=>{let{isLoading:a,data:t}=l.h.monitor.summaryByEstablishment.useQuery({category:e}),i=t?.map(e=>{let s=e.productCampaigns.map(e=>({id:e.product.id,name:e.product.name,area:e.area})),a=e.productCampaigns.flatMap(e=>e.productKpis.map(e=>({kpiId:e.kpi.id,name:e.kpi.name,category:e.kpi.category,unit:e.kpi.unit,key:e.kpi.key,scopes:e.scopes?[{scope1:e.scopes.scope1,scope2:e.scopes.scope2,scope3:e.scopes.scope3}]:[],currentValue:e.totalValue})));return{establishmentId:e.establishmentId,establishment:{area:e.establishment.area,name:e.establishment.name,latitude:e.establishment.latitude,longitude:e.establishment.longitude,soilType:e.establishment.soilType,soilPH:e.establishment.soilPh,organicMaterial:e.establishment.organicMaterial,nitrogen:e.establishment.nitrogen,phosphorous:e.establishment.phosphorus},products:s,kpis:a}}),calculateKpis=e=>{let s=[];return(e??[]).forEach(({kpis:e})=>{e.forEach(e=>{let a=s.find(s=>s.id===e.kpiId);a?a.value+=e.currentValue:s.push({id:e.kpiId,name:e.name,value:e.currentValue,unit:e.unit,key:e.key})})}),s},c=["scope1","scope2","scope3"],calculateScopes=e=>{let a=s?i?.filter(e=>e.establishmentId===s.id):i;return c.reduce((s,t)=>(s[t]=e?(a??[]).reduce((e,{kpis:s})=>s.reduce((e,s)=>s.scopes[0]?e+s.scopes[0][t]:e,0)+e,0):0,s),{})},n={},o=i;s&&(o=i?.filter(e=>e.establishmentId===s?.id)),o?.forEach(({products:e})=>{e.forEach(e=>{let s=n[e.id];s?s.area+=e.area:n[e.id]={name:e.name,area:e.area}})});let d=Object.values(n).reduce((e,s)=>e+s.area,0),p=(()=>{let s=calculateKpis(i);return{kpiValues:s,scopes:"ClimateChange"===e?calculateScopes(s[0]?.value):void 0,area:(i??[]).reduce((e,{establishment:s})=>s.area?e+s.area:e,0),latitude:null,longitude:null,soilType:(i??[]).map(({establishment:e})=>e.soilType).filter((e,s,a)=>a.indexOf(e)===s).join(", "),soilPH:null,organicMaterial:null,nitrogen:null,phosphorous:null,products:Object.values(n),totalHarvestedArea:d}})(),[m,u]=(0,r.useState)();return(0,r.useEffect)(()=>{t&&!m&&u(p)},[t]),(0,r.useEffect)(()=>{if(s){let a=(i??[]).find(({establishmentId:e})=>e===s.id);if(a){let{products:s,establishment:t}=a,r=[];r.push(a);let l=calculateKpis(r);u({kpiValues:l,scopes:"ClimateChange"===e?calculateScopes(l[0]?.value):void 0,products:s,area:t.area,latitude:t.latitude,longitude:t.longitude,soilType:t.soilType,soilPH:t.soilPH,organicMaterial:t.organicMaterial,nitrogen:t.nitrogen,phosphorous:t.phosphorous,totalHarvestedArea:d})}}else u(p)},[s]),{filteredData:m,toDMS:(e,s)=>{if(null===e)return"-";let a=Math.abs(e),t=Math.floor(a),r=(a-t)*60,l=Math.floor(r),i="";return i=s?e>=0?"E":"W":e>=0?"N":"S",`${t}\xb0${l}'${Math.floor((r-l)*60)}"${i}`},pageDataLoading:a,establishmentsCampaign:i,showOngoingCampaign:()=>{if(s){let e=t?.find(e=>e.establishmentId===s.id),a=e?.productCampaigns.find(e=>!e.endDate);return!!a}let e=t?.flatMap(e=>e.productCampaigns),a=e?.find(e=>!e.endDate);return!!a},noFinishedCampaigns:()=>{if(s){let e=t?.find(e=>e.establishmentId===s.id),a=e?.productCampaigns.find(e=>!!e.endDate);return!a}let e=t?.flatMap(e=>e.productCampaigns),a=e?.find(e=>!!e.endDate);return!a}}};t()}catch(e){t(e)}})},6882:(e,s,a)=>{a.a(e,async(e,t)=>{try{a.r(s),a.d(s,{default:()=>u,getServerSideProps:()=>getServerSideProps});var r=a(997),l=a(6689),i=a(2948),c=a(6310),n=a(7989),o=a(7200),d=a(6697),p=a(2836),m=e([c,n,o,d,p]);[c,n,o,d,p]=m.then?(await m)():m;let SummaryByEstablishmentPage=()=>{let[e,s]=(0,l.useState)("absolute"),[a,t]=(0,l.useState)("climateChange"),[i,d]=(0,l.useState)();return a&&r.jsx(n.Z,{switchTabs:r.jsx(c.Z,{key1:"intensity",key2:"absolute",setSelected:s,defaultValue:"absolute"}),className:"w-full",selectedTab:a,setSelectedTab:t,tabs:[{key:"climateChange",content:r.jsx(o.Z,{selectedSwitchTab:e,category:"ClimateChange",showScopes:!0,selectedEstablishment:i,setSelectedEstablishment:d})},{key:"ecosystemQuality",content:r.jsx(o.Z,{selectedSwitchTab:e,category:"EcosystemQuality",selectedEstablishment:i,setSelectedEstablishment:d})},{key:"humanHealth",content:r.jsx(o.Z,{selectedSwitchTab:e,category:"HumanHealth",selectedEstablishment:i,setSelectedEstablishment:d})},{key:"resourcesExhaustion",content:r.jsx(o.Z,{selectedSwitchTab:e,category:"ResourcesExhaustion",selectedEstablishment:i,setSelectedEstablishment:d})}]})};SummaryByEstablishmentPage.getLayout=e=>r.jsx(d.Z,{titleKey:"summaryByEstablishment",children:e});let getServerSideProps=async e=>{let s=await (0,p.x)(e);return await Promise.all([s.monitor.summaryByEstablishment.prefetch({category:"ClimateChange"}),s.monitor.summaryByEstablishment.prefetch({category:"EcosystemQuality"}),s.monitor.summaryByEstablishment.prefetch({category:"HumanHealth"}),s.monitor.summaryByEstablishment.prefetch({category:"ResourcesExhaustion"})]),{props:{trpcState:s.dehydrate(),messages:await (0,i.E)(e.locale)}}},u=SummaryByEstablishmentPage;t()}catch(e){t(e)}})},1841:e=>{e.exports=require("@aws-sdk/client-s3")},4298:e=>{e.exports=require("@aws-sdk/client-ses")},3303:e=>{e.exports=require("@paralleldrive/cuid2")},3524:e=>{e.exports=require("@prisma/client")},7620:e=>{e.exports=require("@radix-ui/react-avatar")},3363:e=>{e.exports=require("@radix-ui/react-dialog")},8532:e=>{e.exports=require("@radix-ui/react-dropdown-menu")},4034:e=>{e.exports=require("@radix-ui/react-select")},2479:e=>{e.exports=require("@radix-ui/react-toast")},2433:e=>{e.exports=require("@react-google-maps/api")},8432:e=>{e.exports=require("bcryptjs")},8103:e=>{e.exports=require("clsx")},9344:e=>{e.exports=require("jsonwebtoken")},3227:e=>{e.exports=require("next-auth")},7449:e=>{e.exports=require("next-auth/providers/credentials")},1649:e=>{e.exports=require("next-auth/react")},503:e=>{e.exports=require("next-intl")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},5184:e=>{e.exports=require("nodemailer")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},72:e=>{e.exports=require("superjson")},1656:e=>{e.exports=import("@hookform/resolvers/zod")},7412:e=>{e.exports=import("@radix-ui/react-accordion")},49:e=>{e.exports=import("@radix-ui/react-label")},307:e=>{e.exports=import("@radix-ui/react-scroll-area")},6860:e=>{e.exports=import("@radix-ui/react-tabs")},6704:e=>{e.exports=import("@radix-ui/react-tooltip")},7717:e=>{e.exports=import("@react-email/components")},846:e=>{e.exports=import("@react-email/font")},4116:e=>{e.exports=import("@react-email/head")},8816:e=>{e.exports=import("@react-email/render")},3594:e=>{e.exports=import("@t3-oss/env-core")},6206:e=>{e.exports=import("@t3-oss/env-nextjs")},272:e=>{e.exports=import("@trpc/client")},7455:e=>{e.exports=import("@trpc/next")},5468:e=>{e.exports=import("@trpc/react-query/server")},2937:e=>{e.exports=import("@trpc/server")},6926:e=>{e.exports=import("class-variance-authority")},5641:e=>{e.exports=import("react-hook-form")},8097:e=>{e.exports=import("tailwind-merge")},9926:e=>{e.exports=import("zod")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var s=require("../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),a=s.X(0,[1938,8724,7457,5632,5487,9244,6983,4801,2876,1172,3833,2836,6391,7989,4429,4830,5188,403],()=>__webpack_exec__(544));module.exports=a})();